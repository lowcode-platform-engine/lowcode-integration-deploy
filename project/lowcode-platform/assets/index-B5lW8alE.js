var u=Object.defineProperty;var b=(o,e,n)=>e in o?u(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var l=(o,e,n)=>b(o,typeof e!="symbol"?e+"":e,n);import{R as x,o as h,a,n as i}from"./index-D2t72-yQ.js";import{S as g,e as d,c as m,j as S}from"./DecorateContextV3-CphvitVs.js";import"./index-CJyGQGl4.js";import"./index.browser-DChRJmk7.js";import"./storage-C2-tuK8u.js";const f=`body,ol,ul,h1,h2,h3,h4,h5,h6,p,th,td,dl,dd,form,fieldset,legend,input,textarea,select{margin:0;padding:0} 
            body{font:12px"宋体","Arial Narrow",HELVETICA;background:#fff;-webkit-text-size-adjust:100%;} 
            a{color:#2d374b;text-decoration:none} 
            a:hover{color:#cd0200;text-decoration:underline} 
            em{font-style:normal} 
            li{list-style:none} 
            img{border:0;vertical-align:middle} 
            table{border-collapse:collapse;border-spacing:0} 
            p{word-wrap:break-word} 
            html, body { width: 100%; height: 100%; #testSandboxContainer {width: 100%; height: fit-content;}}`,y="var link = document.createElement('link');link.rel = 'stylesheet';link.type = 'text/css';link.href = 'https://at.alicdn.com/t/c/font_4440054_mrd2ueh02sj.css';var head = document.getElementsByTagName('head')[0];head.insertBefore(link, head.firstChild);";class w{constructor(){l(this,"sandbox");this.sandbox=new g({callHost(...e){return console.log(...e),Promise.resolve(e)},callHostSync(...e){return console.log(...e),e}},{frameContainer:"#root",baseUrl:location.origin,allowedSenderOrigin:location.origin}),console.log("设置沙箱内部运行时"),this.sandbox.contentWindow.React=x,this.sandbox.contentWindow.ReactDOM=h,this.sandbox.contentWindow.previewer=d.previewer,this.sandbox.contentWindow.PageComponentDependency=d.previewer.componentDependencyLoader,console.log(this.sandbox.contentWindow),this.sandbox.injectStyle(f),this.sandbox.injectStyle(m),this.sandbox.run(S),this.sandbox.run(y),console.log(d)}registerSandboxSyncApi(){this.sandbox.registerSandboxSyncServiceMethods({getSandboxLibStatus:function(e){return!!window[e]},createButton:function(){var t,s;const e=document.createElement("button");if(e.innerHTML="点击测试调用宿主机方法",e.addEventListener("click",async()=>{var c;console.log("点击了按钮");const r=await((c=window.Websandbox.connection)==null?void 0:c.remote.callHostSync("testMethod"));console.log(r)}),!document.querySelector("body")){const r=document.createElement("body");(t=document.querySelector("html"))==null||t.appendChild(r)}(s=document.querySelector("body"))==null||s.appendChild(e)}})}registerSandboxApi(){this.sandbox.registerSandboxServiceMethods({getUserInfo:function(e){return new Promise(n=>{setTimeout(()=>{n({name:"ssss",age:30,id:e})},2e3)})}})}}const v=o=>{const e=a.useRef(),n=a.useRef(!1),t=a.useRef(),[s,r]=a.useState(!0);return a.useEffect(()=>{(async()=>{var c;n.current||(t.current=new w,r(!1),(c=o==null?void 0:o.onInitSuccess)==null||c.call(o),n.current=!0)})()},[]),{frameContainer:e,loading:s,lowcodeEditorSandbox:t}},L=()=>{const{frameContainer:o,lowcodeEditorSandbox:e}=v({onInitSuccess:()=>Promise.resolve()});return i.jsxs(i.Fragment,{children:[i.jsx("div",{ref:o}),i.jsx("button",{onClick:()=>{var n,t;(t=(n=e.current)==null?void 0:n.sandbox)==null||t.call("runCode","console.log(123)")},children:"测试通过沙箱执行jscode"}),i.jsx("button",{onClick:()=>{var n;(n=e.current)==null||n.registerSandboxSyncApi()},children:"给沙箱注册同步API（getSandboxLibStatus | createButton）"}),i.jsx("button",{onClick:()=>{var t,s;const n=(s=(t=e.current)==null?void 0:t.sandbox)==null?void 0:s.callSync("getSandboxLibStatus","alert");console.log(n)},children:"同步调用沙箱内部的getSandboxLibStatus"}),i.jsx("button",{onClick:()=>{var t,s;const n=(s=(t=e.current)==null?void 0:t.sandbox)==null?void 0:s.callSync("createButton");console.log(n)},children:"同步调用沙箱内部的createButton"}),i.jsx("button",{onClick:()=>{var n;(n=e.current)==null||n.registerSandboxApi()},children:"给沙箱注册异步API（getUserInfo）"}),i.jsx("button",{onClick:async()=>{var t,s;const n=await((s=(t=e.current)==null?void 0:t.sandbox)==null?void 0:s.call("getUserInfo",20));console.log(n)},children:"异步调用沙箱内部的getUserInfo"})]})};export{L as TestBuildingPage,L as default};
