import{d as e,f as a,a as t,q as o,i as l,C as n,o as r,Y as u,y as d,F as i,j as s,n as m,w as c,m as p,N as h,l as b,Z as f,H as v,_ as y}from"./index-455b6c01.js";const g=y(e({...e({name:"componentManagementVersionInfo"}),setup(e){const y=a();let{proxy:g}=v();const w=e=>{_.table.pageSize=e,V()},x=e=>{_.table.currentPage=e,V()},_=t({componentName:"",query:{committer:"",version:"",id:""},table:{total:0,pageSize:10,currentPage:1,data:[],columns:[{prop:"version",label:"版本",minWidth:120,render:(e,a)=>{return o(l("el-button"),{type:"text",onClick:()=>(e=>{e.operateSchema&&(q.show=!0,q.schemaInfo=(null==e?void 0:e.schemaInfo)||{})})(a)},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!f(t)?e:{default:()=>[e]});var t}},{prop:"committer",label:"提交者",minWidth:120},{prop:"crateTimeLabel",label:"发布时间",minWidth:140},{prop:"status",label:"状态",minWidth:120,render:(e,a)=>{const t={0:"待生效",1:"已发布",2:"已下线"},n={0:"primary",1:"success",2:"info"}[null==a?void 0:a.status]||"info";return o(l("el-tag"),{effect:"light",type:n},{default:()=>[t[null==a?void 0:a.status]]})}},{prop:"commitLog",label:"提交日志",minWidth:140,render:e=>o("div",null,[e])}],operator:[{text:"默认数据",show:{key:"operateSchema",val:[!0]},fun:e=>{var a;I.show=!0,I.modalInfo=(null==(a=null==e?void 0:e.schema)?void 0:a.defaultValue)||{}}},{text:"预览",show:{key:"operatePreview",val:[!0]},disabled:!0,fun:e=>{}},{text:"废弃",show:{key:"operateOffLine",val:[!0]},fun:e=>{}}],operatorConfig:{fixed:"right",align:"center",width:"160",label:"操作"}},listTypeInfo:{}}),q=t({show:!1,schemaInfo:{}}),I=t({show:!1,modalInfo:{}}),S=n((()=>({version:{label:"版本号",comp:"el-input"},committer:{label:"提交者",comp:"el-input"}}))),P=e=>{_.query={..._.query,...e},V("search")};r((()=>{g.$route.query.id&&(_.query.id=Number(g.$route.query.id)),g.$route.query.name&&(_.componentName=g.$route.query.name),V()}));const V=async e=>{"search"==e&&(_.table.currentPage=1);let a=null;try{a=await u({..._.query,page:_.table.currentPage,pageSize:_.table.pageSize,committer:_.query.committer,version:_.query.version})}catch(o){d({message:o.message,type:"error",duration:5e3})}if(!a)return;_.table.total=a.data&&a.data.count||0,_.table.data=a.data&&a.data.data?a.data.data:[],_.table.data.forEach((e=>{var a,t,l,n;try{e.crateTimeLabel=i(e.crateTime).format("YYYY-MM-DD HH:mm"),e.schemaInfo=e.schema||{},e.modalInfo=e.modal||{},e.operateOffLine=!0===(null==(a=null==e?void 0:e.operate)?void 0:a.offLine),e.operateDelete=!0===(null==(t=null==e?void 0:e.operate)?void 0:t.delete),e.operatePreview=!0===(null==(l=null==e?void 0:e.operate)?void 0:l.preview),e.operateSchema=!0===(null==(n=null==e?void 0:e.operate)?void 0:n.schema)}catch(o){}}));const t=Math.ceil(_.table.total/_.table.pageSize);return t<_.table.currentPage&&0!==_.table.total?(_.table.currentPage=t,V()):0===_.table.total&&(_.table.currentPage=1),!1};return(e,a)=>{const t=l("el-page-header"),n=l("t-query-condition"),r=l("t-layout-page-item"),u=l("t-table"),d=l("JsonViewer"),i=l("el-scrollbar"),f=l("el-drawer"),v=l("t-layout-page");return s(),m(v,{class:"page_manage_container"},{default:c((()=>[o(r,null,{default:c((()=>[o(t,{onBack:a[0]||(a[0]=()=>p(h)(p(y)))},{content:c((()=>a[3]||(a[3]=[b("span",{class:"text-large font-600 mr-3"}," 组件版本 ",-1)]))),_:1}),o(n,{opts:S.value,onSubmit:P},null,8,["opts"])])),_:1}),o(r,null,{default:c((()=>[o(u,{title:`${p(_).componentName}`,table:p(_).table,columns:p(_).table.columns,onSizeChange:w,onPageChange:x},{toolbar:c((()=>a[4]||(a[4]=[]))),_:1},8,["title","table","columns"])])),_:1}),o(f,{"append-to-body":!0,"with-header":!1,modelValue:p(q).show,"onUpdate:modelValue":a[1]||(a[1]=e=>p(q).show=e),title:p(_).componentName},{default:c((()=>[o(i,null,{default:c((()=>[o(d,{expanded:!0,"expand-depth":5,value:p(q).schemaInfo,copyable:"",boxed:"",sort:"",theme:"dark"},null,8,["value"])])),_:1})])),_:1},8,["modelValue","title"]),o(f,{"append-to-body":!0,"expand-depth":5,"with-header":!1,modelValue:p(I).show,"onUpdate:modelValue":a[2]||(a[2]=e=>p(I).show=e),title:p(_).componentName},{default:c((()=>[o(i,null,{default:c((()=>[o(d,{expanded:!0,"expand-depth":5,value:p(I).modalInfo,copyable:"",boxed:"",sort:"",theme:"dark"},null,8,["value"])])),_:1})])),_:1},8,["modelValue","title"])])),_:1})}}}),[["__scopeId","data-v-97c76d16"]]);export{g as default};
