import{d as e,f as a,r as t,C as l,a as s,q as r,t as o,i as n,J as i,$ as d,o as p,j as u,n as m,w as c,m as f,N as b,l as y,H as g,a0 as h,y as w,a1 as v,a2 as I,a3 as L,_ as T}from"./index-455b6c01.js";import{g as q}from"./index-6d1bc2c2.js";const x=T(e({...e({name:"pageManagementInfo"}),setup(e){const T=a();let{proxy:x}=g();const $=t(null),_=e=>{const a={...e.baseInfo,...e.otherInfo,id:x.$route.query.id,domains:e.otherInfo.domain};x.$route.query.id?h(a).then((e=>{e.success?(w({type:"success",message:"更新成功"}),k()):w({type:"error",message:e.message||"系统错误"})})).catch((e=>{w({type:"error",message:e.message||"系统错误"})})):v(a).then((e=>{e.success?(w({type:"success",message:"创建成功"}),b(T)):w({type:"error",message:e.message||"系统错误"})})).catch((e=>{w({type:"error",message:e.message||"系统错误"})}))},z=l((()=>{var e,a,t;return x.$route.query.name?x.$route.query.name:null==(t=null==(a=null==(e=null==D?void 0:D.baseInfo)?void 0:e.opts)?void 0:a.formData)?void 0:t.name})),D=s({baseInfo:{title:"基本信息",disabled:!0,name:"baseInfo",ref:null,widthSize:1,opts:{formData:{id:`${Math.floor(10*Math.random()+1)}`,name:null,title:null,path:null,prependPath:"/lowcode-web/",bizCode:[],sceneType:null},fieldList:[{label:"页面名称",width:"50vw",value:"name",type:"input",comp:"el-input",event:"name",placeholder:"请输入页面名称，如 店铺首页"},{value:"title",type:"el-input",comp:"el-input",width:"50vw",placeholder:"请输入页面标题",labelRender:()=>r("span",{style:"display: flex; align-items: center;"},[o("页面标题"),r(n("el-tooltip"),{className:"box-item",effect:"dark",content:"同 HTML 中 title 属性",placement:"top"},{default:()=>[r(n("el-icon"),{style:"margin-left: 4px"},{default:()=>[r(i,null,null)]})]})])},{label:"页面路径",value:"path",slotName:"path",labelRender:()=>r("span",{style:"display: flex; align-items: center;"},[o("页面路径"),r(n("el-tooltip"),{className:"box-item",effect:"dark",content:"路径只能是英文数字划线的组合并且不能和其他页面路径重复",placement:"top"},{default:()=>[r(n("el-icon"),{style:"margin-left: 4px"},{default:()=>[r(i,null,null)]})]})])},{label:"场景类型",width:"50vw",value:"sceneType",type:"select-arr",comp:"el-select",list:"sceneTypeList",bind:{disabled:!!x.$route.query.id},arrLabel:"label",arrKey:"value"},{label:"业务类别",value:"bizCode",width:"50vw",type:"select-arr",comp:"el-select",list:"bizList",bind:{disabled:!1,multiple:!0,filterable:!0,clearable:!0,multipleLimit:2},arrLabel:"label",arrKey:"value"}],listTypeInfo:{sceneTypeList:[],bizList:[]},rules:{name:[{required:!0,message:"请输入页面名称",trigger:"blur"},{max:20,message:"页面名称不能超过20字符",trigger:"blur"}],title:[{required:!0,message:"请输入页面标题",trigger:"blur"},{max:50,message:"页面标题不能超过50字符",trigger:"blur"}],path:[{required:!0,message:"请输入页面路径",trigger:"blur"},{trigger:"blur",validator:async(e,a,t)=>{if(!a)return t(new Error("请输入页面路径"));if(a.length>50)return t(new Error("页面路径不能超过50字符"));if(a.startsWith("/"))return t(new Error("页面路径不能以/开头"));if(a.includes("http")||a.includes("ftp"))return t(new Error("页面路径不能包含网络协议"));if(!/^[a-zA-Z0-9-]+$/.test(a))return t(new Error("页面路径只能是英文字母、数字和中划线的组合"));try{if(x.$route.query.id)return t();return(await d(a)).data?t():t(new Error("页面路径已存在，请更换"))}catch(l){return t(new Error("系统异常，请稍后重试"))}}}],sceneType:[{required:!0,message:"场景类型不能为空",trigger:"blur"}]}}},otherInfo:{title:"其他信息",name:"otherInfo",disabled:!0,widthSize:1,opts:{formData:{domain:[],desc:null},fieldList:[{label:"域名",value:"domain",width:"50vw",type:"select-arr",comp:"el-select",list:"domainList",bind:{disabled:!1,multiple:!0,filterable:!0,clearable:!0},arrLabel:"label",arrKey:"value"},{label:"页面描述",value:"desc",type:"textarea",comp:"el-input",width:"50vw"}],listTypeInfo:{domainList:[]},rules:{domain:[{required:!0,message:"域名不能为空",trigger:"blur"}]}}}}),k=()=>{I(x.$route.query.id).then((e=>{if(e.success){const{data:a}=e;let t=[];(null==a?void 0:a.domains)&&Array.isArray(a.domains)&&(t=a.domains.map((e=>null==e?void 0:e.info.code))),D.baseInfo.opts.formData={...D.baseInfo.opts.formData,name:a.name,title:a.title,path:a.path,prependPath:a.prependPath||"/lowcode-web/",bizCode:a.bizCode.split(","),sceneType:a.sceneType},D.otherInfo.opts.formData={...D.otherInfo.opts.formData,domain:t,desc:a.desc}}}))};return p((()=>{(async()=>{const e=await L(),a=await q("page");if(a.success){const{pageBizConfig:t=[],pageSceneConfig:l=[]}=a.data||{};D.baseInfo.opts.listTypeInfo.sceneTypeList=(l||[]).map((e=>({key:e.value,...e}))),D.baseInfo.opts.listTypeInfo.bizList=(t||[]).map((e=>({key:e.value,...e}))),e.data&&(D.otherInfo.opts.listTypeInfo.domainList=e.data.map((e=>({...e,value:e.code,key:e.code,label:e.name}))))}})(),x.$route.query.id&&k()})),(e,a)=>{const t=n("el-page-header"),l=n("el-option"),s=n("el-select"),o=n("el-input"),i=n("t-module-form"),d=n("t-layout-page-item"),p=n("t-layout-page");return u(),m(p,{class:"page_manage_container"},{default:c((()=>[r(d,null,{default:c((()=>[r(t,{onBack:a[0]||(a[0]=()=>f(b)(f(T)))},{content:c((()=>a[3]||(a[3]=[y("span",{class:"text-large font-600 mr-3"}," 页面元数据 ",-1)]))),_:1}),r(i,{subTitle:z.value,ref_key:"sourceForm",ref:$,titleBold:"",formOpts:f(D),submit:_},{path:c((()=>[r(o,{placeholder:"请输入页面路径，如 shop-home",disabled:!!f(x).$route.query.id,style:{width:"50vw"},modelValue:f(D).baseInfo.opts.formData.path,"onUpdate:modelValue":a[2]||(a[2]=e=>f(D).baseInfo.opts.formData.path=e)},{prepend:c((()=>[r(s,{modelValue:f(D).baseInfo.opts.formData.prependPath,"onUpdate:modelValue":a[1]||(a[1]=e=>f(D).baseInfo.opts.formData.prependPath=e),placeholder:"Select",style:{width:"140px"}},{default:c((()=>[r(l,{label:"lowcode-web/",value:"/lowcode-web/"})])),_:1},8,["modelValue"])])),_:1},8,["disabled","modelValue"])])),_:1},8,["subTitle","formOpts"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-9d35ca0e"]]);export{x as default};
