import{d as e,f as a,r as t,I as l,a as o,q as i,i as n,C as s,o as r,F as c,aF as d,j as u,n as p,w as m,m as b,l as y,t as f,Z as g,y as h,ax as k}from"./index-455b6c01.js";import{o as v,a as z}from"./constant-bd962a5b.js";import{u as S,j as _,k as w,e as T}from"./index-6d1bc2c2.js";const x={class:"dialog-footer"};const j=e({...e({name:"FileList"}),setup(e){a();const j=t(),M=t(S),C=t({Authorization:`Bearer ${l()||""}`}),P=o({isShowModal:!1,modal:{biz:"111",bucketType:"cdn"}}),W=()=>{P.isShowModal=!1,P.modal={biz:"",bucketType:"cdn"}},q=(e,a,t)=>{h.success("文件上传成功");t.every((e=>"success"===e.status))&&(P.isShowModal=!1,P.modal={biz:"",bucketType:"cdn"})},B=async()=>{try{j.value.submit()}catch(e){}},D=o({query:{key:"",createTime:null},roleIds:[],table:{total:0,pageSize:20,currentPage:1,data:[],columns:[{prop:"key",label:"key",minWidth:160},{prop:"tags",label:"tags",minWidth:160,render:(e,a)=>{const t=(a.tags||"").split(",");return t.length&&a.tags?i("div",null,[t.map(((e,a)=>{return i(n("el-tag"),{style:{marginLeft:"2px"},key:`${a}_${e}`},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!g(t)?e:{default:()=>[e]});var t}))]):"-"}},{prop:"bucket",label:"bucket",minWidth:120},{prop:"domain",label:"domain",minWidth:120},{prop:"size",label:"size",minWidth:120},{prop:"mimetype",label:"mimetype",minWidth:120},{prop:"crateTimeLabel",label:"创建时间",minWidth:140}],operator:[{text:"详情",fun:e=>{T({key:e.key,bucket:e.bucket}).then((e=>{document.createElement("a"),window.open(`${e}`)}))}},{text:"删除",fun:e=>{k.confirm("此操作将会删除该数据，是否继续?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{await w({list:[{srcBucket:e.config.bucket,key:e.key}]}),h({type:"success",message:"Delete completed"}),O("search")})).catch((()=>{h({type:"info",message:"Delete canceled"}),O()}))}}],operatorConfig:{fixed:"right",align:"center",width:"120",label:"操作"}},listTypeInfo:{orderStatus:v,orderType:z}}),I=s((()=>({code:{label:"key",comp:"el-input"},createTime:{label:"时间",comp:"el-date-picker",bind:{type:"date",placeholder:"请选择"}}}))),L=e=>{D.query={...D.query,...e},O("search")};r((()=>{O()}));const O=async e=>{"search"==e&&(D.table.currentPage=1);const a=await _({page:D.table.currentPage,pageSize:D.table.pageSize,key:D.query.key,createTime:D.query.createTime});D.table.total=a.data&&a.data.count||0,D.table.data=a.data&&a.data.data?a.data.data:[],D.table.data.forEach((e=>{var a,t,l,o,i;e.crateTimeLabel=c(e.crateTime).format("YYYY-MM-DD HH:mm"),e.config="string"==typeof e.info?JSON.parse(e.info):{},e.domain=null==(a=null==e?void 0:e.config)?void 0:a.domain,e.bucket=null==(t=null==e?void 0:e.config)?void 0:t.bucket,e.size=(null==(l=null==e?void 0:e.config)?void 0:l.size)?d(null==(o=null==e?void 0:e.config)?void 0:o.size):"--",e.mimetype=null==(i=null==e?void 0:e.config)?void 0:i.mimetype}));const t=Math.ceil(D.table.total/D.table.pageSize);return t<D.table.currentPage&&0!==D.table.total?(D.table.currentPage=t,O()):0===D.table.total&&(D.table.currentPage=1),!1},Y=e=>{D.table.pageSize=e,O()},$=e=>{D.table.currentPage=e,O()};return(e,a)=>{const t=n("t-query-condition"),l=n("t-layout-page-item"),o=n("el-button"),s=n("t-table"),r=n("el-upload"),c=n("el-form-item"),d=n("el-form"),g=n("el-dialog"),h=n("t-layout-page");return u(),p(h,null,{default:m((()=>[i(l,null,{default:m((()=>[i(t,{opts:b(I),onSubmit:L},null,8,["opts"])])),_:1}),i(l,null,{default:m((()=>[i(s,{title:"文件列表",table:b(D).table,columns:b(D).table.columns,onSizeChange:Y,onPageChange:$},{toolbar:m((()=>[y("div",null,[i(o,{type:"primary",onClick:a[0]||(a[0]=e=>b(P).isShowModal=!0)},{default:m((()=>a[2]||(a[2]=[f("上传文件")]))),_:1})])])),_:1},8,["table","columns"])])),_:1}),i(g,{"destroy-on-close":"",class:"custom-class-message-info-dialog",top:"100px",modelValue:b(P).isShowModal,"onUpdate:modelValue":a[1]||(a[1]=e=>b(P).isShowModal=e),title:"上传文件",width:"55%",center:""},{footer:m((()=>[y("span",x,[i(o,{onClick:W},{default:m((()=>a[5]||(a[5]=[f("取消")]))),_:1}),i(o,{type:"primary",onClick:B},{default:m((()=>a[6]||(a[6]=[f(" 确认 ")]))),_:1})])])),default:m((()=>[i(d,{inline:!0,model:b(P).modal,class:"demo-form-inline"},{default:m((()=>[i(c,{label:"文件"},{default:m((()=>[i(r,{limit:3,ref_key:"uploadRef",ref:j,class:"upload-demo",action:b(M),data:b(P).modal,headers:b(C),"on-success":q,"auto-upload":!1},{trigger:m((()=>[i(o,{type:"primary"},{default:m((()=>a[3]||(a[3]=[f("选择文件")]))),_:1})])),tip:m((()=>a[4]||(a[4]=[y("div",{class:"el-upload__tip"},"jpg/png files with a size less than 500kb",-1)]))),_:1},8,["action","data","headers"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])),_:1})}}});export{j as default};
