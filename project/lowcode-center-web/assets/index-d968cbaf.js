import{d as e,r as a,a as l,C as o,o as t,aQ as d,F as s,i as n,j as i,n as r,w as u,q as c,m,t as f,l as p,aR as b,aS as g,y as h,G as w,ax as y,aT as V}from"./index-455b6c01.js";const _={class:"dialog-footer"},x=e({...e({name:"roleManageList"}),setup(e){const x=a(),C=l({info:{name:"",code:"",desc:""},rules:{name:[{required:!0,message:"请输入角色名",trigger:"blur"},{min:4,max:16,message:"角色名必须要在4到16位之间",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"},{min:4,max:16,message:"角色编码必须要在4到16位之间",trigger:"blur"}]},show:!1}),q=l({info:{name:"",code:"",desc:""},show:!1,rules:[]}),S=()=>{C.show=!0,w((()=>{C.info={name:"",code:"",desc:"",id:""}}))},P=()=>{C.info={name:"",code:"",desc:"",id:""}},U=l({query:{name:""},roleIds:[],table:{total:0,pageSize:10,currentPage:1,data:[],columns:[{prop:"name",label:"角色名称",minWidth:120},{prop:"code",label:"权限字符",minWidth:120},{prop:"crateTimeLabel",label:"创建时间",minWidth:140}],operator:[{text:"编辑",show:{key:"isDelete",val:[1]},fun:e=>{C.show=!0,w((()=>{C.info={name:e.name,code:e.code,desc:e.desc,id:e.id}}))}},{text:"详情",fun:e=>{q.show=!0,w((()=>{q.info={name:e.name,code:e.code,desc:e.desc,id:e.id}}))}},{text:"删除",show:{key:"isDelete",val:[1]},fun:e=>{y.confirm("此操作将会删除该数据，是否继续?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{await V({ids:[e.id]}),h({type:"success",message:"Delete completed"}),T("search")})).catch((()=>{h({type:"info",message:"Delete canceled"})}))}}],operatorConfig:{fixed:"right",align:"center",width:"160",label:"操作"}}}),k=o((()=>({name:{label:"角色名称",comp:"el-input"}}))),D=e=>{U.roleIds=e.map((e=>e.roleId))},z=e=>{U.query={...U.query,...e},T("search")};t((()=>{T()}));const T=async e=>{"search"==e&&(U.table.currentPage=1);const a=await d({...U.query,page:U.table.currentPage,pageSize:U.table.pageSize,name:U.query.name});U.table.total=a.data&&a.data.count||0,U.table.data=a.data&&a.data.data?a.data.data:[],U.table.data.forEach((e=>{e.crateTimeLabel=s(e.crateTime).format("YYYY-MM-DD HH:mm"),e.status=0===e.isDelete}));const l=Math.ceil(U.table.total/U.table.pageSize);return l<U.table.currentPage&&0!==U.table.total?(U.table.currentPage=l,T()):0===U.table.total&&(U.table.currentPage=1),!1},v=e=>{U.table.pageSize=e,T()},F=e=>{U.table.currentPage=e,T()};return(e,a)=>{const l=n("t-query-condition"),o=n("t-layout-page-item"),t=n("el-button"),d=n("t-table"),s=n("el-input"),w=n("el-form-item"),y=n("el-form"),V=n("el-dialog"),M=n("t-layout-page");return i(),r(M,null,{default:u((()=>[c(o,null,{default:u((()=>[c(l,{opts:m(k),onSubmit:z},null,8,["opts"])])),_:1}),c(o,null,{default:u((()=>[c(d,{title:"角色管理列表",table:m(U).table,columns:m(U).table.columns,onSelectionChange:D,onSizeChange:v,onPageChange:F},{toolbar:u((()=>[c(t,{type:"primary",onClick:S},{default:u((()=>a[10]||(a[10]=[f("新增")]))),_:1})])),_:1},8,["table","columns"])])),_:1}),c(V,{class:"custom-class-message-info-dialog",modelValue:m(C).show,"onUpdate:modelValue":a[5]||(a[5]=e=>m(C).show=e),title:"角色",width:"500px",draggable:"","destroy-on-close":"","show-close":!1,top:"100px",onClose:P},{footer:u((()=>[p("span",_,[c(t,{onClick:a[3]||(a[3]=e=>(m(x).resetFields(),void(C.show=!1)))},{default:u((()=>a[11]||(a[11]=[f("取消")]))),_:1}),c(t,{type:"primary",onClick:a[4]||(a[4]=e=>{var a;(a=m(x))&&a.validate((async e=>{if(!e)return!1;{let e;e=C.info.id?await b({code:C.info.code,desc:C.info.desc,name:C.info.name,id:C.info.id}):await g({code:C.info.code,desc:C.info.desc,name:C.info.name}),e.success?(h.success("创建成功"),a.resetFields(),T("search"),C.show=!1):h.error(e.message||"系统错误")}}))})},{default:u((()=>a[12]||(a[12]=[f("确认")]))),_:1})])])),default:u((()=>[c(y,{model:m(C).info,rules:m(C).rules,ref_key:"ruleFormRef",ref:x},{default:u((()=>[c(w,{label:"角色名:","label-width":100,prop:"name"},{default:u((()=>[c(s,{modelValue:m(C).info.name,"onUpdate:modelValue":a[0]||(a[0]=e=>m(C).info.name=e)},null,8,["modelValue"])])),_:1}),c(w,{label:"编码:","label-width":100,prop:"code"},{default:u((()=>[c(s,{modelValue:m(C).info.code,"onUpdate:modelValue":a[1]||(a[1]=e=>m(C).info.code=e),disabled:!!m(C).info.id},null,8,["modelValue","disabled"])])),_:1}),c(w,{label:"描述:","label-width":100,prop:"desc"},{default:u((()=>[c(s,{modelValue:m(C).info.desc,"onUpdate:modelValue":a[2]||(a[2]=e=>m(C).info.desc=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),c(V,{class:"custom-class-message-info-dialog",modelValue:m(q).show,"onUpdate:modelValue":a[9]||(a[9]=e=>m(q).show=e),title:"角色详情",width:"500px",draggable:"","destroy-on-close":"",top:"100px"},{footer:u((()=>a[13]||(a[13]=[]))),default:u((()=>[c(y,{model:m(q).info,rules:m(q).rules,ref_key:"ruleFormRef",ref:x},{default:u((()=>[c(w,{label:"角色名:","label-width":100,prop:"name"},{default:u((()=>[c(s,{modelValue:m(q).info.name,"onUpdate:modelValue":a[6]||(a[6]=e=>m(q).info.name=e),disabled:!0},null,8,["modelValue"])])),_:1}),c(w,{label:"编码:","label-width":100,prop:"code"},{default:u((()=>[c(s,{modelValue:m(q).info.code,"onUpdate:modelValue":a[7]||(a[7]=e=>m(q).info.code=e),disabled:!0},null,8,["modelValue"])])),_:1}),c(w,{label:"描述:","label-width":100,prop:"desc"},{default:u((()=>[c(s,{modelValue:m(q).info.desc,"onUpdate:modelValue":a[8]||(a[8]=e=>m(q).info.desc=e),disabled:!0},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])),_:1})}}});export{x as default};
