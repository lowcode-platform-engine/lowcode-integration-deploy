import{d as e,f as a,r as l,I as t,ay as o,a as d,C as r,o as i,az as s,F as u,i as n,j as m,n as c,w as p,q as b,m as g,l as f,t as h,aA as w,aB as y,y as v}from"./index-455b6c01.js";import{o as q,a as S}from"./constant-bd962a5b.js";import{u as V}from"./index-6d1bc2c2.js";const _={class:"dialog-footer"},E=e({...e({name:"DomainCenterList"}),setup(e){a(),l();const E=l();l(V),l({Authorization:`Bearer ${t()||""}`});const x=l({name:[{required:!0,message:"请输入名称",trigger:"blur"}],value:[{required:!0,message:"请输入域名，不要携带协议",trigger:"blur"}],desc:[{required:!0,message:"请输入描述",trigger:"blur"}],code:[{required:!0,message:"请输入编码",trigger:"blur"},{trigger:"blur",validator:async(e,a,l)=>{if(!a)return l(new Error("请输入请输入编码"));if(a.length>50)return l(new Error("编码不能超过50字符"));if(M.isEdit)return l();if(!/^[a-zA-Z0-9-]+$/.test(a))return l(new Error("编码只能是英文字母、数字和中划线的组合"));try{return(await o(a)).data?l():l(new Error("该编码已存在，请更换"))}catch(t){return l(new Error("系统异常，请稍后重试"))}}}]}),M=d({isShowModal:!1,isEdit:!1,modal:{name:"",code:"",value:"",desc:""}}),z=()=>{M.isShowModal=!1,M.isEdit=!1,M.modal={name:"",code:"",value:"",desc:""}},C=async()=>{var e;if(await(null==(e=E.value)?void 0:e.validate())){let e;e=M.isEdit?await w({name:M.modal.name,code:M.modal.code,value:M.modal.value,desc:M.modal.desc}):await y({name:M.modal.name,code:M.modal.code,value:M.modal.value,desc:M.modal.desc}),e.success?(v.success("操作成功"),M.isShowModal=!1,M.isEdit=!1,M.modal={name:"",code:"",value:"",desc:""},W("search")):v.error("操作失败")}},P=d({query:{name:""},roleIds:[],table:{total:0,pageSize:20,currentPage:1,data:[],columns:[{prop:"name",label:"名称",minWidth:160},{prop:"code",label:"编码",minWidth:120},{prop:"value",label:"域名",minWidth:120},{prop:"desc",label:"描述",minWidth:120},{prop:"crateTimeLabel",label:"更新时间",minWidth:140}],operator:[{text:"编辑",fun:e=>{M.isShowModal=!0,M.isEdit=!0,M.modal={name:e.name,code:e.code,value:e.value,desc:e.desc}}}],operatorConfig:{fixed:"right",align:"center",width:"120",label:"操作"}},listTypeInfo:{orderStatus:q,orderType:S}}),T=r((()=>({code:{label:"编码",comp:"el-input"},name:{label:"名称",comp:"el-input"},value:{label:"域名",comp:"el-input"}}))),U=e=>{P.query={...P.query,...e},W("search")};i((()=>{W()}));const W=async e=>{"search"==e&&(P.table.currentPage=1);const a=await s({page:P.table.currentPage,pageSize:P.table.pageSize,name:P.query.name,code:P.query.code,value:P.query.value});P.table.total=a.data&&a.data.count||0,P.table.data=a.data&&a.data.data?a.data.data:[],P.table.data.forEach((e=>{e.crateTimeLabel=u(e.updateTime).format("YYYY-MM-DD HH:mm")}));const l=Math.ceil(P.table.total/P.table.pageSize);return l<P.table.currentPage&&0!==P.table.total?(P.table.currentPage=l,W()):0===P.table.total&&(P.table.currentPage=1),!1},j=e=>{P.table.pageSize=e,W()},k=e=>{P.table.currentPage=e,W()};return(e,a)=>{const l=n("t-query-condition"),t=n("t-layout-page-item"),o=n("el-button"),d=n("t-table"),r=n("el-input"),i=n("el-form-item"),s=n("el-form"),u=n("el-dialog"),w=n("t-layout-page");return m(),c(w,null,{default:p((()=>[b(t,null,{default:p((()=>[b(l,{opts:g(T),onSubmit:U},null,8,["opts"])])),_:1}),b(t,null,{default:p((()=>[b(d,{title:"域名管理",table:g(P).table,columns:g(P).table.columns,onSizeChange:j,onPageChange:k},{toolbar:p((()=>[f("div",null,[b(o,{type:"primary",onClick:a[0]||(a[0]=e=>g(M).isShowModal=!0)},{default:p((()=>a[6]||(a[6]=[h("新增")]))),_:1})])])),_:1},8,["table","columns"])])),_:1}),b(u,{"destroy-on-close":"",class:"custom-class-message-info-dialog",top:"100px",modelValue:g(M).isShowModal,"onUpdate:modelValue":a[5]||(a[5]=e=>g(M).isShowModal=e),title:"新增域名",width:"30%"},{footer:p((()=>[f("span",_,[b(o,{onClick:z},{default:p((()=>a[7]||(a[7]=[h("取消")]))),_:1}),b(o,{type:"primary",onClick:C},{default:p((()=>a[8]||(a[8]=[h(" 确认 ")]))),_:1})])])),default:p((()=>[b(s,{ref_key:"form",ref:E,inline:!0,rules:g(x),model:g(M).modal,class:"demo-form-inline"},{default:p((()=>[b(i,{"label-width":"100",required:"",label:"名称",prop:"name",style:{width:"100%"}},{default:p((()=>[b(r,{modelValue:g(M).modal.name,"onUpdate:modelValue":a[1]||(a[1]=e=>g(M).modal.name=e),max:"30",placeholder:"请输入"},null,8,["modelValue"])])),_:1}),b(i,{"label-width":"100",required:"",label:"编码",prop:"code",style:{width:"100%"}},{default:p((()=>[b(r,{modelValue:g(M).modal.code,"onUpdate:modelValue":a[2]||(a[2]=e=>g(M).modal.code=e),max:"30",placeholder:"请输入",disabled:g(M).isEdit},null,8,["modelValue","disabled"])])),_:1}),b(i,{"label-width":"100",required:"",label:"域名",prop:"value",style:{width:"100%"}},{default:p((()=>[b(r,{modelValue:g(M).modal.value,"onUpdate:modelValue":a[3]||(a[3]=e=>g(M).modal.value=e),max:"30",placeholder:"请输入，不要携带协议"},null,8,["modelValue"])])),_:1}),b(i,{"label-width":"100",required:"",label:"描述",prop:"desc",style:{width:"100%"}},{default:p((()=>[b(r,{modelValue:g(M).modal.desc,"onUpdate:modelValue":a[4]||(a[4]=e=>g(M).modal.desc=e),max:"50",placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"])])),_:1})}}});export{E as default};
