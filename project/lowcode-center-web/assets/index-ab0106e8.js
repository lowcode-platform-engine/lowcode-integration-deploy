import{d as a,f as e,r as t,I as l,a as o,C as s,o as r,aC as n,F as d,i,j as u,n as c,w as p,q as m,m as b,l as f,t as g,y as h}from"./index-455b6c01.js";import{o as y,a as w}from"./constant-bd962a5b.js";import{u as S,e as _}from"./index-6d1bc2c2.js";const z={class:"dialog-footer"},k=a({...a({name:"DownloadCenterList"}),setup(a){e();const k=t(),C=t(S),M=t({Authorization:`Bearer ${l()||""}`}),P=o({isShowModal:!1,modal:{biz:"111"}}),x=()=>{P.isShowModal=!1,P.modal={biz:""}},T=(a,e,t)=>{h.success("文件上传成功");t.every((a=>"success"===a.status))&&(P.isShowModal=!1,P.modal={biz:""})},j=async()=>{try{k.value.submit()}catch(a){}},v=o({query:{},roleIds:[],table:{total:0,pageSize:20,currentPage:1,data:[],columns:[{prop:"name",label:"名称"},{prop:"resultOss",label:"资源包"},{prop:"note",label:"备注",width:260},{prop:"crateTimeLabel",label:"下载时间",width:180}],operator:[{text:"详情",fun:a=>{_({key:a.resultOss,bucket:a.bucket}).then((a=>{document.createElement("a").href=a,window.open(`${a}`)}))},noshow:[{key:"resultOss",val:[null,""]}]}],operatorConfig:{fixed:"right",align:"center",width:"120",label:"操作"}},listTypeInfo:{orderStatus:y,orderType:w}});s((()=>({code:{label:"key",comp:"el-input"},createTime:{label:"时间",comp:"el-date-picker",bind:{type:"date",placeholder:"请选择"}}}))),r((()=>{I()}));const I=async a=>{"search"==a&&(v.table.currentPage=1);const e=await n({page:v.table.currentPage,pageSize:v.table.pageSize});v.table.total=e.data&&e.data.count||0,v.table.data=e.data&&e.data.data?e.data.data:[],v.table.data.forEach((a=>{a.crateTimeLabel=d(a.crateTime).format("YYYY-MM-DD HH:mm")}));const t=Math.ceil(v.table.total/v.table.pageSize);return t<v.table.currentPage&&0!==v.table.total?(v.table.currentPage=t,I()):0===v.table.total&&(v.table.currentPage=1),!1},Y=a=>{v.table.pageSize=a,I()},D=a=>{v.table.currentPage=a,I()};return(a,e)=>{const t=i("t-table"),l=i("t-layout-page-item"),o=i("el-button"),s=i("el-upload"),r=i("el-form-item"),n=i("el-form"),d=i("el-dialog"),h=i("t-layout-page");return u(),c(h,null,{default:p((()=>[m(l,null,{default:p((()=>[m(t,{title:"我的下载",table:b(v).table,columns:b(v).table.columns,onSizeChange:Y,onPageChange:D},null,8,["table","columns"])])),_:1}),m(d,{"destroy-on-close":"",class:"custom-class-message-info-dialog",top:"100px",modelValue:b(P).isShowModal,"onUpdate:modelValue":e[0]||(e[0]=a=>b(P).isShowModal=a),title:"上传文件",width:"55%",center:""},{footer:p((()=>[f("span",z,[m(o,{onClick:x},{default:p((()=>e[3]||(e[3]=[g("取消")]))),_:1}),m(o,{type:"primary",onClick:j},{default:p((()=>e[4]||(e[4]=[g(" 确认 ")]))),_:1})])])),default:p((()=>[m(n,{inline:!0,model:b(P).modal,class:"demo-form-inline"},{default:p((()=>[m(r,{label:"文件"},{default:p((()=>[m(s,{limit:3,ref_key:"uploadRef",ref:k,class:"upload-demo",action:b(C),data:b(P).modal,headers:b(M),"on-success":T,"auto-upload":!1},{trigger:p((()=>[m(o,{type:"primary"},{default:p((()=>e[1]||(e[1]=[g("选择文件")]))),_:1})])),tip:p((()=>e[2]||(e[2]=[f("div",{class:"el-upload__tip"},"jpg/png files with a size less than 500kb",-1)]))),_:1},8,["action","data","headers"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])),_:1})}}});export{k as default};
