import{ar as e,au as a,d as l,f as t,r as o,I as d,av as r,a as i,aw as s,q as n,t as m,C as c,o as u,F as p,i as y,j as h,n as v,w,m as f,l as b,k as V,a8 as g,a9 as S,U as C,B as M,G as _,y as E,ax as x}from"./index-455b6c01.js";import{o as k,a as q}from"./constant-bd962a5b.js";import{u as j,v as L,a as T,b as U,c as z,d as O}from"./index-6d1bc2c2.js";import{S as P}from"./SchemaRender-0f9c0dff.js";import"./loader-421e4912.js";const $={style:{width:"400px",height:"250px"}},A={class:"dialog-footer"},B={class:"dialog-footer"},J={style:{flex:"auto"},class:"dialog-footer"},N=l({...l({name:"DictionaryCenterList"}),setup(l){t(),o();const N=o();o(j);const R=o();o({Authorization:`Bearer ${d()||""}`});const D={automaticLayout:!0,formatOnType:!0,formatOnPaste:!0,language:"json"};o("// some code...");const W=r(),I=e=>W.value=e,Y=()=>{X.isShowModal=!0,R.value=null,X.modal={isEdit:!1,description:"",code:"",dictionaryValue:"",type:s[0].value}},H=o({code:[{required:!0,message:"请输入编码",trigger:"blur"},{trigger:"blur",validator:async(e,a,l)=>{if(!a)return l(new Error("请输入请输入编码"));if(a.length>50)return l(new Error("编码不能超过50字符"));if(X.modal.isEdit)return l();if(!/^[a-zA-Z0-9-]+$/.test(a))return l(new Error("编码只能是英文字母、数字和中划线的组合"));try{return(await L(a)).data?l():l(new Error("该字典已存在，请更换"))}catch(t){return l(new Error("系统异常，请稍后重试"))}}}],dictionaryValue:[{required:!0,message:"请输入字典值",trigger:"blur"},{trigger:"blur",validator:async(e,a,l)=>{if(!a)return l(new Error("请输入字典值"));if("array"===X.modal.type)try{const e=JSON.parse(X.modal.dictionaryValue);return e&&Array.isArray(e)?l():l(new Error("请输入字典值不是集合"))}catch(t){return l(new Error("输入的字典值不是正确的集合格式"))}if("object"===X.modal.type)try{const e=JSON.parse(X.modal.dictionaryValue);return!e||"object"!=typeof e||Array.isArray(e)?l(new Error("请输入字典值不是对象")):l()}catch(t){return l(new Error("输入的字典值不是正确的对象格式"))}if("json"===X.modal.type)try{return JSON.parse(X.modal.dictionaryValue),l()}catch(t){return l(new Error("输入的字典值不是正确的json格式"))}return"boolean"===X.modal.type?[!0,!1,"true","false"].includes(a)?l():l(new Error("输入的字典值不是布尔值")):"number"===X.modal.type?/^[-+]?[0-9]*\.?[0-9]+$/.test(a.toString())?l():l(new Error("输入的字典值不是数值")):l()}}]}),K=o(),F=o(),G=()=>{_((async()=>{var e,a,l,t;const o=(null==(e=null==ae?void 0:ae.modal)?void 0:e.templateSchema)?JSON.parse(null==(a=null==ae?void 0:ae.modal)?void 0:a.templateSchema):{},d=(null==(l=null==ae?void 0:ae.modal)?void 0:l.value)?JSON.parse(null==(t=null==ae?void 0:ae.modal)?void 0:t.value):{};await(async e=>{var a,l;try{await(null==(l=(a=K.value).setSchema)?void 0:l.call(a,e))}catch(t){}})(o),await(async e=>{var a,l;try{await(null==(l=(a=K.value).setValues)?void 0:l.call(a,e))}catch(t){}})(d||{})}))},Z=()=>{_((async()=>{var e,a,l,t;const o=(null==(e=null==le?void 0:le.modal)?void 0:e.templateSchema)?JSON.parse(null==(a=null==le?void 0:le.modal)?void 0:a.templateSchema):{};try{await(null==(t=(l=F.value).setSchema)?void 0:t.call(l,o))}catch(d){}}))},Q=o({templateCode:[{required:!0,message:"不能为空",trigger:"blur"}],templateVersion:[{required:!0,message:"不能为空",trigger:"blur"}]}),X=i({isShowModal:!1,modal:{isEdit:!1,code:"",type:s[0].value,dictionaryValue:"",description:""}}),ee=i({isShowModal:!1,templateList:[],versionList:[],modal:{isEdit:!1,code:"",templateCode:"",templateVersion:"",templateSchema:""}}),ae=i({isShowModal:!1,modal:{isEdit:!1,code:"",templateCode:"",templateVersion:"",templateSchema:"",value:""}}),le=i({isShowModal:!1,modal:{templateCode:"",templateVersion:"",templateSchema:""}}),te=()=>{le.isShowModal=!1,le.modal={templateCode:"",templateVersion:"",templateSchema:""}},oe=async l=>{const t=await(o=l,e({url:`${a}/lowcode-center-server/v1.0/dictionary/templateVersions`,method:"get",params:{code:o},data:{}}));var o;ee.versionList=((null==t?void 0:t.data)||[]).map((e=>({label:e.version,value:e.version,...e})))},de=async e=>{const a=ee.versionList.find((a=>a.value===e));a&&(ee.modal.templateSchema=a.schema)},re=()=>{X.isShowModal=!1,R.value=null,X.modal={isEdit:!1,description:"",code:"",dictionaryValue:"",type:s[0].value}},ie=()=>{ee.isShowModal=!1,ee.modal={isEdit:!1,templateCode:"",code:"",templateVersion:"",templateSchema:""}},se=async()=>{var e;if(await(null==(e=N.value)?void 0:e.validate()))if(X.modal.isEdit){(await z(R.value.id,{code:X.modal.code,type:X.modal.type,dictionaryValue:X.modal.dictionaryValue,description:X.modal.description})).success?(E.success("操作成功"),X.isShowModal=!1,X.modal={isEdit:!1,description:"",code:"",dictionaryValue:"",type:s[0].value},R.value=null,we("search")):E.error("操作失败")}else{(await U({code:X.modal.code,type:X.modal.type,dictionaryValue:X.modal.dictionaryValue,description:X.modal.description})).success?(E.success("操作成功"),X.isShowModal=!1,X.modal={isEdit:!1,description:"",code:"",dictionaryValue:"",type:s[0].value},R.value=null,we("search")):E.error("操作失败")}},ne=async()=>{var l;if(await(null==(l=N.value)?void 0:l.validate())){(await(t=ee.modal.code,o={templateCode:ee.modal.templateCode,templateSchema:ee.modal.templateSchema,templateVersion:ee.modal.templateVersion},e({url:`${a}/lowcode-center-server/v1.0/dictionary/updateTemplate`,method:"post",params:{},data:{code:t,...o}}))).success?(E.success("操作成功"),ee.isShowModal=!1,ee.modal={isEdit:!1,templateCode:"",code:"",templateVersion:"",templateSchema:""},we("search")):E.error("操作失败")}var t,o},me=async()=>{le.isShowModal=!0,le.modal={templateCode:ee.modal.templateCode,templateSchema:ee.modal.templateSchema,templateVersion:ee.modal.templateVersion}},ce=async()=>{var l,t,o,d;try{const r=await(null==(t=(l=K.value).save)?void 0:t.call(l));(await(o=ae.modal.code,d=r,e({url:`${a}/lowcode-center-server/v1.0/dictionary/updateValue`,method:"post",params:{},data:{code:o,value:d}}))).success?(E.success("操作成功"),we("search")):E.error("操作失败")}catch(r){}},ue=async()=>{pe(),ae.isShowModal=!1,ae.modal={isEdit:!0,templateCode:"",templateSchema:"",value:"",code:"",templateVersion:""}},pe=()=>{(async()=>{var e,a;try{await(null==(a=(e=K.value).reset)?void 0:a.call(e))}catch(l){}})()},ye=i({query:{code:""},roleIds:[],table:{total:0,pageSize:20,currentPage:1,data:[],columns:[{prop:"index",label:"序号",width:80},{prop:"code",label:"编码",minWidth:120},{prop:"description",label:"描述",minWidth:120},{prop:"crateTimeLabel",label:"创建时间",minWidth:140},{prop:"templateCode",label:"模板",minWidth:100},{prop:"templateVersion",label:"模板版本"}],operator:[{render:(e,a)=>n("span",{onClick:()=>(e=>{x.confirm("此操作将会删除该数据，是否继续?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{await O(e.id),E({type:"success",message:"Delete completed"}),we("search")})).catch((()=>{E({type:"info",message:"Delete canceled"}),we()}))})(a)},[m("删除")])},{render:(e,a)=>n("span",{onClick:()=>{R.value=a,X.isShowModal=!0,X.modal={isEdit:!0,description:a.description,code:a.code,dictionaryValue:a.dictionaryValue,type:a.type}}},[m("编辑")])},{render:(l,t)=>n("span",{onClick:async()=>{ee.isShowModal=!0;const l=await e({url:`${a}/lowcode-center-server/v1.0/dictionary/templateList`,method:"get",params:{},data:{}});ee.templateList=((null==l?void 0:l.data)||[]).map((e=>({value:e.code,label:`${e.name}(${e.code})`,...e}))),ee.modal={isEdit:!0,templateCode:t.templateCode,templateSchema:t.templateSchema,code:t.code,templateVersion:t.templateVersion},t.templateCode&&await oe(t.templateCode)}},[m("设置模板")])},{show:{key:"showTemplateButton",val:[!0]},render:(e,a)=>n("span",{onClick:async()=>{ae.isShowModal=!0,ae.modal={isEdit:!0,templateCode:a.templateCode,templateSchema:a.templateSchema,value:a.dictionaryValue,code:a.code,templateVersion:a.templateVersion}}},[m("设置值")])}],operatorConfig:{fixed:"right",align:"center",width:"220",label:"操作"}},listTypeInfo:{orderStatus:k,orderType:q}}),he=c((()=>({code:{label:"编码",comp:"el-input"}}))),ve=e=>{ye.query={...ye.query,...e},we("search")};u((()=>{we()}));const we=async e=>{"search"==e&&(ye.table.currentPage=1);const a=await T({page:ye.table.currentPage,pageSize:ye.table.pageSize,code:ye.query.code});ye.table.total=a.data&&a.data.count||0,ye.table.data=a.data&&a.data.data?a.data.data:[],ye.table.data.forEach(((e,a)=>{e.crateTimeLabel=p(e.crateTime).format("YYYY-MM-DD HH:mm"),e.index=a,e.showTemplateButton=!(!e.templateCode||!e.templateVersion),e.description=e.description||"-"}));const l=Math.ceil(ye.table.total/ye.table.pageSize);return l<ye.table.currentPage&&0!==ye.table.total?(ye.table.currentPage=l,we()):0===ye.table.total&&(ye.table.currentPage=1),!1},fe=e=>{ye.table.pageSize=e,we()},be=e=>{ye.table.currentPage=e,we()};return(e,a)=>{const l=y("t-query-condition"),t=y("t-layout-page-item"),o=y("el-button"),d=y("t-table"),r=y("el-input"),i=y("el-form-item"),c=y("el-option"),u=y("el-select"),p=y("vue-monaco-editor"),_=y("el-form"),E=y("el-dialog"),x=y("el-drawer"),k=y("t-layout-page");return h(),v(k,null,{default:w((()=>[n(t,null,{default:w((()=>[n(l,{boolEnter:!1,opts:f(he),onSubmit:ve},null,8,["opts"])])),_:1}),n(t,null,{default:w((()=>[n(d,{title:"字典管理",table:f(ye).table,columns:f(ye).table.columns,onSizeChange:fe,onPageChange:be},{toolbar:w((()=>[b("div",null,[n(o,{type:"primary",onClick:Y},{default:w((()=>a[10]||(a[10]=[m("新增")]))),_:1})])])),_:1},8,["table","columns"])])),_:1}),n(E,{"destroy-on-close":"",class:"custom-class-message-info-dialog",top:"100px",modelValue:f(X).isShowModal,"onUpdate:modelValue":a[4]||(a[4]=e=>f(X).isShowModal=e),title:"新增字典",width:"580px"},{footer:w((()=>[b("span",A,[n(o,{onClick:re},{default:w((()=>a[11]||(a[11]=[m("取消")]))),_:1}),n(o,{type:"primary",onClick:se},{default:w((()=>a[12]||(a[12]=[m(" 确认 ")]))),_:1})])])),default:w((()=>[n(_,{"label-position":"right",ref_key:"form",ref:N,"label-width":"100px",rules:f(H),model:f(X).modal,class:"demo-form-inline"},{default:w((()=>[n(i,{"label-width":"120",required:"",label:"编码",prop:"code"},{default:w((()=>[n(r,{modelValue:f(X).modal.code,"onUpdate:modelValue":a[0]||(a[0]=e=>f(X).modal.code=e),disabled:f(X).modal.isEdit,max:"10",style:{width:"400px"}},null,8,["modelValue","disabled"])])),_:1}),n(i,{"label-width":"120",required:"",label:"类型",prop:"type"},{default:w((()=>[n(u,{modelValue:f(X).modal.type,"onUpdate:modelValue":a[1]||(a[1]=e=>f(X).modal.type=e),max:"10",style:{width:"400px"}},{default:w((()=>[(h(!0),V(g,null,S(f(s),((e,a)=>(h(),v(c,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(i,{"label-width":"120",required:"",label:"字典",prop:"dictionaryValue"},{default:w((()=>[b("div",$,[n(p,{value:f(X).modal.dictionaryValue,"onUpdate:value":a[2]||(a[2]=e=>f(X).modal.dictionaryValue=e),theme:"vs-dark",language:"json",options:D,onMount:I},null,8,["value"])])])),_:1}),n(i,{"label-width":"120",label:"描述",prop:"description"},{default:w((()=>[n(r,{"show-word-limit":!0,type:"textarea",modelValue:f(X).modal.description,"onUpdate:modelValue":a[3]||(a[3]=e=>f(X).modal.description=e),max:"250",style:{width:"400px"}},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"]),n(E,{"destroy-on-close":"",class:"custom-class-message-info-dialog",top:"100px",modelValue:f(ee).isShowModal,"onUpdate:modelValue":a[7]||(a[7]=e=>f(ee).isShowModal=e),title:"设置模板",width:"580px"},{footer:w((()=>[b("span",B,[n(o,{onClick:ie},{default:w((()=>a[13]||(a[13]=[m("取消")]))),_:1}),n(o,{type:"primary",onClick:me,disabled:!f(ee).modal.templateCode||!f(ee).modal.templateVersion},{default:w((()=>a[14]||(a[14]=[m(" 预览 ")]))),_:1},8,["disabled"]),n(o,{type:"primary",onClick:ne},{default:w((()=>a[15]||(a[15]=[m(" 确认 ")]))),_:1})])])),default:w((()=>[n(_,{"label-position":"right",ref_key:"form",ref:N,"label-width":"100px",rules:f(Q),model:f(ee).modal,class:"demo-form-inline"},{default:w((()=>[n(i,{"label-width":"120",required:"",label:"模板",prop:"templateCode"},{default:w((()=>[n(u,{modelValue:f(ee).modal.templateCode,"onUpdate:modelValue":a[5]||(a[5]=e=>f(ee).modal.templateCode=e),max:"10",style:{width:"400px"},onChange:oe},{default:w((()=>[(h(!0),V(g,null,S(f(ee).templateList,((e,a)=>(h(),v(c,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(i,{"label-width":"120",required:"",label:"版本",prop:"templateVersion"},{default:w((()=>[n(u,{modelValue:f(ee).modal.templateVersion,"onUpdate:modelValue":a[6]||(a[6]=e=>f(ee).modal.templateVersion=e),max:"10",style:{width:"400px"},disabled:!f(ee).modal.templateCode,onChange:de},{default:w((()=>[(h(!0),V(g,null,S(f(ee).versionList,((e,a)=>(h(),v(c,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"]),n(x,{modelValue:f(ae).isShowModal,"onUpdate:modelValue":a[8]||(a[8]=e=>f(ae).isShowModal=e),direction:"rtl",class:"custom-class-schema-info-dialog",size:"60%",onClose:ue},{header:w((()=>[b("div",null,C(f(ae).modal.templateCode)+"@"+C(f(ae).modal.templateVersion),1)])),default:w((()=>[f(ae).isShowModal?(h(),v(P,{key:0,ref_key:"schemaRenderRef",ref:K,onMounted:G,style:{height:"100%"}},null,512)):M("",!0)])),footer:w((()=>[b("div",J,[n(o,{onClick:pe},{default:w((()=>a[16]||(a[16]=[m("重置")]))),_:1}),n(o,{onClick:ue},{default:w((()=>a[17]||(a[17]=[m("取消")]))),_:1}),n(o,{type:"primary",onClick:ce},{default:w((()=>a[18]||(a[18]=[m("确认")]))),_:1})])])),_:1},8,["modelValue"]),n(x,{modelValue:f(le).isShowModal,"onUpdate:modelValue":a[9]||(a[9]=e=>f(le).isShowModal=e),direction:"rtl",class:"custom-class-schema-info-dialog",size:"60%",onClose:te},{header:w((()=>[b("div",null,C(f(le).modal.templateCode)+"@"+C(f(le).modal.templateVersion),1)])),default:w((()=>[f(le).isShowModal?(h(),v(P,{key:0,ref_key:"previewSchemaRenderRef",ref:F,onMounted:Z,style:{height:"100%"}},null,512)):M("",!0)])),_:1},8,["modelValue"])])),_:1})}}});export{N as default};
