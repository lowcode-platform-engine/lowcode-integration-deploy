import{d as e,f as a,r as t,a as l,q as n,t as o,i as s,a4 as i,a5 as r,a6 as u,C as d,o as p,a7 as c,F as m,j as f,n as g,w as h,m as b,l as y,B as v,k as w,a8 as k,a9 as P,U as _,aa as N,y as T,ab as C,ac as L,ad as q}from"./index-455b6c01.js";import{g as x}from"./index-6d1bc2c2.js";const V={class:"query_tab"},M={class:"el-dropdown-link"},I={class:"dialog-footer"},S={class:"dialog-footer"},z=e({...e({name:"pageList"}),setup(e){const z=a();t({});const D=e=>{j.table.pageSize=e,G()},E=e=>{j.table.currentPage=e,G()},W=()=>{z.push({path:"/atomManagement/pageManage/info",query:{}})},A=async e=>{try{await L(O.row.id)}catch(a){T.error("下线失败")}G("search"),O.show=!1,O.row=null},U=async e=>{try{await q(H.row.id)}catch(a){T.error("下线失败")}G("search"),H.show=!1,H.row=null},Y=()=>{G("search")},j=l({query:{name:"",title:"",path:"",id:"",author:"",sceneType:"",status:"",bizCode:[],isAll:!1},table:{total:0,pageSize:10,currentPage:1,data:[],columns:[{prop:"id",label:"页面Id",render:(e,a)=>e||"--"},{prop:"name",label:"页面信息",minWidth:200,render:(e,a)=>n("div",{class:"page-info-item-container"},[a.title&&n("div",{className:"page-item-name"},[n("span",{className:"key"},[o("页面标题:")]),n("span",{className:"value"},[a.title||"--","pc"===a.sceneType&&n("div",{className:"icon-item"},[n(s("el-tooltip"),{className:"box-item",effect:"dark",content:"pc",placement:"top"},{default:()=>[n(s("el-icon"),null,{default:()=>[n(i,null,null)]})]})]),"h5"===a.sceneType&&n("div",{className:"icon-item"},[n(s("el-tooltip"),{className:"box-item",effect:"dark",content:"h5",placement:"top"},{default:()=>[n(s("el-icon"),{className:"icon-item"},{default:()=>[n(r,{size:"28",style:"width: 14px"},null)]})]})])])]),a.name&&n("div",{className:"page-item-name"},[n("span",{className:"key"},[o("页面名称:")]),n("span",{className:"value"},[a.name||"--"])]),n("div",{className:"page-item-name"},[n("span",{className:"key"},[o("创建者:")]),n("span",{className:"value"},[a.author||"--"])])])},{prop:"path",label:"页面路径",minWidth:"180",slotName:"path"},{prop:"status",label:"页面状态",minWidth:120,render:(e,a)=>{const t={"-2":"danger","-1":"info",0:"primary",1:"success"}[null==a?void 0:a.status]||"info";return n(s("el-tag"),{effect:"light",type:t},{default:()=>[a.statusName||"-"]})}},{prop:"env",label:"发布状态",render:(e,a)=>{const t={EDIT_ING:"info",TEST:"primary",PROD:"success"}[null==a?void 0:a.env]||"info";return-1===a.status?n(s("el-tag"),{effect:"light",type:"info"},{default:()=>[o("已下线")]}):n(s("el-tag"),{effect:"light",type:t},{default:()=>[a.envName||"-"]})}},{prop:"crateTimeLabel",label:"创建时间",minWidth:140}],operator:[{text:"元数据",fun:e=>{z.push({path:"/atomManagement/pageManage/info",query:{id:e.id,name:e.name}})},noshow:[{key:"operateEditMeta",val:[!1]}]},{text:"版本",fun:e=>{z.push({path:"/atomManagement/pageManage/version",query:{id:e.id,name:e.name}})},noshow:[{key:"status",val:[u.delete]},{key:"operateVersion",val:[!1]}]},{text:"下线",fun:e=>{O.show=!0,O.row=e},show:{key:"operateOffLinePage",val:[!0]}},{text:"删除",fun:e=>{H.show=!0,H.row=e},show:{key:"operateDeletePage",val:[!0]}}],operatorConfig:{fixed:"right",align:"center",width:"160",label:"操作"}},listTypeInfo:{pageStatusList:[{label:"新创建",value:0},{label:"已发布",value:1},{label:"已下线",value:-1},{label:"已删除",value:-2}],sceneTypeList:[{label:"PC",value:"pc"},{label:"H5",value:"h5"}]}}),H=l({show:!1,row:null}),O=l({show:!1,row:null}),B=d((()=>({title:{label:"页面标题",comp:"el-input",bind:{clearable:!0}},name:{label:"页面名称",comp:"el-input",bind:{clearable:!0}},id:{label:"页面ID",comp:"el-input",bind:{clearable:!0}},path:{label:"页面路径",comp:"el-input",bind:{clearable:!0}},author:{label:"创建者",comp:"el-input",bind:{clearable:!0}},status:{label:"页面状态",comp:"el-select",changeEvent:"change",type:"select-arr",list:"pageStatusList",listTypeInfo:j.listTypeInfo,bind:{clearable:!0}},sceneType:{label:"业务场景",comp:"el-select",changeEvent:"change",type:"select-arr",list:"sceneTypeList",listTypeInfo:j.listTypeInfo}}))),F=e=>{j.query={...j.query,...e},G("search")};p((()=>{(async()=>{const e=await x("page");if(e.success){const{pageBizConfig:a=[],pageSceneConfig:t=[]}=e.data||{};j.listTypeInfo.sceneTypeList=(t||[]).map((e=>({key:e.value,...e})))}})(),G()}));const G=async e=>{"search"==e&&(j.table.currentPage=1);const a=await c({...j.query,page:j.table.currentPage,pageSize:j.table.pageSize,name:j.query.name});j.table.total=a.data&&a.data.count||0,j.table.data=a.data&&a.data.data?a.data.data:[],j.table.data.forEach((e=>{var a,t,l,n,o;e.crateTimeLabel=m(e.crateTime).format("YYYY-MM-DD HH:mm"),e.operateEditMeta=!0===(null==(a=null==e?void 0:e.operate)?void 0:a.editMeta),e.operateVersion=!0===(null==(t=null==e?void 0:e.operate)?void 0:t.versionPage),e.operatePublishPreviewPage=!0===(null==(l=null==e?void 0:e.operate)?void 0:l.versionPage),e.operateOffLinePage=!0===(null==(n=null==e?void 0:e.operate)?void 0:n.offLinePage)&&e.status===u.online,e.operateDeletePage=!0===(null==(o=null==e?void 0:e.operate)?void 0:o.deletePage)&&[u.offline,u.create].includes(e.status)}));const t=Math.ceil(j.table.total/j.table.pageSize);return t<j.table.currentPage&&0!==j.table.total?(j.table.currentPage=t,G()):0===j.table.total&&(j.table.currentPage=1),!1};return(e,a)=>{const t=s("t-query-condition"),l=s("t-layout-page-item"),i=s("el-button"),r=s("el-radio-button"),u=s("el-radio-group"),d=s("arrow-down"),p=s("el-icon"),c=s("el-dropdown-item"),m=s("el-dropdown-menu"),L=s("el-dropdown"),q=s("t-table"),x=s("el-dialog"),z=s("t-layout-page");return f(),g(z,{class:"menu_mange"},{default:h((()=>[n(l,null,{default:h((()=>[n(t,{opts:B.value,onSubmit:F},null,8,["opts"])])),_:1}),n(l,null,{default:h((()=>[n(q,{table:b(j).table,columns:b(j).table.columns,onSizeChange:D,onPageChange:E},{toolbar:h((()=>[n(i,{type:"primary",onClick:W},{default:h((()=>a[5]||(a[5]=[o("新增页面")]))),_:1})])),title:h((()=>[y("div",V,[n(u,{modelValue:b(j).query.isAll,"onUpdate:modelValue":a[0]||(a[0]=e=>b(j).query.isAll=e),onChange:Y},{default:h((()=>[n(r,{label:!0},{default:h((()=>a[6]||(a[6]=[o("全部")]))),_:1}),n(r,{label:!1},{default:h((()=>a[7]||(a[7]=[o("我的")]))),_:1})])),_:1},8,["modelValue"])])])),path:h((({scope:e})=>[n(L,{"hide-on-click":!0,trigger:"hover",onVisibleChange:a=>(async(e,a)=>{if(e){if(a.envList&&a.envList.length)return;if(Array.isArray(a.envList)&&0===a.envList.length)return;try{const e=await N(a.id);e.success?a.envList=e.data:T.error("系统开小差了")}catch(t){T.error("系统开小差了")}}})(a,e.row)},{dropdown:h((()=>[(null==e?void 0:e.row.operatePublishPreviewPage)?(f(),g(m,{key:0},{default:h((()=>{var t,l;return[(null==(l=null==(t=null==e?void 0:e.row)?void 0:t.envList)?void 0:l.length)?v("",!0):(f(),g(c,{key:0},{default:h((()=>a[8]||(a[8]=[o("暂无发布环境")]))),_:1})),(f(!0),w(k,null,P((null==e?void 0:e.row.envList)||[],((a,t)=>(f(),g(c,{onClick:t=>((e,a)=>{window.open(`${C(a.path)}`)})(e.row,a),key:t},{default:h((()=>[o(_(a.envName),1)])),_:2},1032,["onClick"])))),128))]})),_:2},1024)):(f(),g(m,{key:1},{default:h((()=>[n(c,null,{default:h((()=>a[9]||(a[9]=[o("您无权限查看")]))),_:1})])),_:1}))])),default:h((()=>[y("span",M,[o(_(e.row.path),1),n(p,{class:"el-icon--right"},{default:h((()=>[n(d)])),_:1})])])),_:2},1032,["onVisibleChange"])])),_:1},8,["table","columns"]),n(x,{modelValue:b(H).show,"onUpdate:modelValue":a[2]||(a[2]=e=>b(H).show=e),title:"Warning",width:"500px"},{footer:h((()=>[y("div",I,[n(i,{onClick:a[1]||(a[1]=e=>b(H).show=!1)},{default:h((()=>a[10]||(a[10]=[o("取消")]))),_:1}),n(i,{type:"primary",onClick:U},{default:h((()=>a[11]||(a[11]=[o(" 确认 ")]))),_:1})])])),default:h((()=>[a[12]||(a[12]=y("span",null,"确定要删除该页面？",-1))])),_:1},8,["modelValue"]),n(x,{modelValue:b(O).show,"onUpdate:modelValue":a[4]||(a[4]=e=>b(O).show=e),title:"Warning",width:"500px"},{footer:h((()=>[y("div",S,[n(i,{onClick:a[3]||(a[3]=e=>b(O).show=!1)},{default:h((()=>a[13]||(a[13]=[o("取消")]))),_:1}),n(i,{type:"primary",onClick:A},{default:h((()=>a[14]||(a[14]=[o(" 确认 ")]))),_:1})])])),default:h((()=>[a[15]||(a[15]=y("span",null,"确定要下线该页面？",-1))])),_:1},8,["modelValue"])])),_:1})])),_:1})}}});export{z as default};
