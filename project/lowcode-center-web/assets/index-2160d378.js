import{d as e,f as a,r as l,a as t,q as o,t as n,i as s,C as i,o as r,F as u,M as d,j as m,n as p,w as c,m as f,l as y,k as b,a8 as h,a9 as g,B as v,y as x,ax as w}from"./index-455b6c01.js";import{M as V,d as I,R as P,e as _,f as k,u as q,h as T,b as U}from"./index-5bcb12b6.js";const C={style:{width:"400px",height:"120px"}},L={class:"dialog-footer"},S=e({...e({name:"resourcesManageList"}),setup(e){const S={automaticLayout:!0,formatOnType:!0,formatOnPaste:!0,language:"json"};a();const A=l(),E=l([]),M=t({info:{id:"",parentId:"",system:"",value:"",icon:"",type:"API",method:V.GET,desc:"",name:"",ext:"{}"},rules:{name:[{required:!0,message:"请输入资源名",trigger:"blur"},{max:50,message:"必须要在50位字符以",trigger:"blur"}],type:[{required:!0,message:"资源类型不能为空",trigger:"blur"}],value:[{required:!0,message:"资源不能为空",trigger:"blur"},{max:100,message:"必须要在100位字符以内",trigger:"blur"}],method:[{validator:(e,a,l)=>"API"!==M.info.type?l():"API"===M.info.type?a?l():l(new Error("请求类型不能为空")):l(),trigger:"blur"}],system:[{required:!0,message:"所属平台不能为空",trigger:"blur"}],parentId:[],desc:[{max:100,message:"必须要在100位字符以内",trigger:"blur"}]},show:!1});t({info:{nick:"",code:""},rules:{},show:!1});const W=()=>{M.info={desc:"",icon:"",method:V.GET,parentId:-1,system:"",type:"API",value:"",name:"",ext:"{}"}},z=()=>{M.show=!0,H()},j=e=>{O.table.pageSize=e,B()},N=e=>{O.table.currentPage=e,B()},O=t({query:{value:"",name:"",type:"",system:""},table:{total:0,pageSize:10,currentPage:1,data:[],columns:[{prop:"name",label:"名称",minWidth:120},{prop:"type",label:"类型",maxWidth:120},{prop:"value",label:"资源值",minWidth:200},{prop:"system",label:"所属平台",minWidth:120},{prop:"status",label:"状态",maxWidth:90,render:(e,a)=>0===e?o(s("el-button"),{link:!0,type:"success"},{default:()=>[n("正常")]}):o(s("el-button"),{link:!0,type:"danger"},{default:()=>[n("异常")]})},{prop:"crateTimeLabel",label:"创建时间",minWidth:140}],operator:[{text:"编辑",fun:async e=>{const{desc:a,id:l,icon:t,method:o,name:n,parentId:s,system:i,type:r,value:u,ext:d}=e;let m=d;try{m=d?JSON.parse(d):{},m=JSON.stringify(m,null,2)}catch(p){m="{}"}M.info={desc:a,icon:t,method:o,name:n,parentId:s,system:i,type:r,value:u,id:l,ext:m},await H(),M.show=!0}},{text:"删除",fun:e=>{w.confirm("删除后会将该资源以及所有的子资源删除， 确定要删除该资源? ","谨慎操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{const a=await T({id:e.id});a.success?(B(),x({type:"success",message:"操作成功"})):x({type:"error",message:a.message||"操作失败"})}catch(a){}})).catch((()=>{x({type:"info",message:"操作取消"})}))}}],operatorConfig:{fixed:"right",align:"center",width:"120",label:"操作"}},listTypeInfo:{platformList:[{dictLabel:"微信小程序",dictValue:"WX"},{dictLabel:"PC",dictValue:"PC"},{dictLabel:"APP",dictValue:"APP"}],typeList:[{label:"API",value:"API"},{label:"MENU",value:"MENU"}]}}),Y=i((()=>({value:{label:"资源值",comp:"el-input"},name:{label:"资源名称",comp:"el-input"},type:{label:"资源类型",comp:"el-select",changeEvent:"change",type:"select-arr",list:"typeList",listTypeInfo:O.listTypeInfo},system:{label:"所属平台",comp:"el-input"}}))),F=e=>{O.query={...O.query,...e},B("search")};r((()=>{B()}));const B=async e=>{"search"==e&&(O.table.currentPage=1);const a=await I({page:O.table.currentPage,pageSize:O.table.pageSize,system:O.query.system,name:O.query.name,value:O.query.value,type:O.query.type});O.table.total=a.data&&a.data.count||0,O.table.data=a.data&&a.data.data?a.data.data:[],O.table.data.forEach((e=>{e.statusLabel=0===e.status?"正常":"异常",e.crateTimeLabel=u(e.crateTime).format("YYYY-MM-DD HH:mm")}));const l=Math.ceil(O.table.total/O.table.pageSize);return l<O.table.currentPage&&0!==O.table.total?(O.table.currentPage=l,B()):0===O.table.total&&(O.table.currentPage=1),!1},H=async()=>{if(M.info.type){const e=await U({type:M.info.type});e.success?E.value=e.data:E.value=[]}};return d((()=>M.info.type),(e=>{e&&H()}),{immediate:!0}),(e,a)=>{const l=s("t-query-condition"),t=s("t-layout-page-item"),i=s("el-button"),r=s("t-table"),u=s("el-input"),d=s("el-form-item"),w=s("el-option"),V=s("el-select"),I=s("el-tree-select"),T=s("vue-monaco-editor"),U=s("el-form"),H=s("el-dialog"),J=s("t-layout-page");return m(),p(J,{class:"menu_mange"},{default:c((()=>[o(t,null,{default:c((()=>[o(l,{boolEnter:!1,opts:f(Y),onSubmit:F},null,8,["opts"])])),_:1}),o(t,null,{default:c((()=>[o(r,{title:"资源列表",table:f(O).table,columns:f(O).table.columns,onSizeChange:j,onPageChange:N},{toolbar:c((()=>[o(i,{type:"primary",onClick:z},{default:c((()=>a[13]||(a[13]=[n("新增")]))),_:1})])),_:1},8,["table","columns"])])),_:1}),o(H,{class:"custom-class-message-info-dialog",modelValue:f(M).show,"onUpdate:modelValue":a[12]||(a[12]=e=>f(M).show=e),title:f(M).info.id?"编辑资源":"创建资源",width:"560px","destroy-on-close":"","show-close":!0,top:"100px",onClose:W},{footer:c((()=>[y("span",L,[o(i,{onClick:a[10]||(a[10]=e=>(f(A).resetFields(),void(M.show=!1)))},{default:c((()=>a[14]||(a[14]=[n("取消")]))),_:1}),o(i,{type:"primary",onClick:a[11]||(a[11]=e=>{var a;(a=f(A))&&a.validate((async e=>{if(!e)return!1;{let e=null,t=M.info.ext;try{t=t?JSON.parse(t):{}}catch(l){return x.error("扩展字段不合规")}e=M.info.id?await q({parentId:M.info.parentId,system:M.info.system,value:M.info.value,icon:M.info.icon,type:M.info.type,method:M.info.method,desc:M.info.desc,name:M.info.name,id:M.info.id,ext:t}):await k({parentId:M.info.parentId,system:M.info.system,value:M.info.value,icon:M.info.icon,type:M.info.type,method:M.info.method,desc:M.info.desc,name:M.info.name,ext:t}),e.success?(x.success("操作成功"),a.resetFields(),B("search"),M.show=!1):x.error(e.message||"系统错误")}}))})},{default:c((()=>a[15]||(a[15]=[n("确认")]))),_:1})])])),default:c((()=>[o(U,{style:{maxHeight:"400px",overflowY:"auto"},model:f(M).info,rules:f(M).rules,ref_key:"ruleFormRef",ref:A},{default:c((()=>[o(d,{label:"资源名:","label-width":100,prop:"name"},{default:c((()=>[o(u,{placeholder:"请输入资源名 如 角色列表查询",clearable:"",autocomplete:"off",modelValue:f(M).info.name,"onUpdate:modelValue":a[0]||(a[0]=e=>f(M).info.name=e)},null,8,["modelValue"])])),_:1}),o(d,{label:"资源类型:","label-width":100,prop:"type"},{default:c((()=>[o(V,{modelValue:f(M).info.type,"onUpdate:modelValue":a[1]||(a[1]=e=>f(M).info.type=e),placeholder:"请选择",clearable:"",onChange:a[2]||(a[2]=()=>{f(M).info.parentId=""})},{default:c((()=>[(m(!0),b(h,null,g(f(P),(e=>(m(),p(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(d,{label:"归属平台:","label-width":100,prop:"system"},{default:c((()=>[o(u,{clearable:"",placeholder:"请输入资源归属平台",autocomplete:"off",modelValue:f(M).info.system,"onUpdate:modelValue":a[3]||(a[3]=e=>f(M).info.system=e)},null,8,["modelValue"])])),_:1}),o(d,{label:"资源值:","label-width":100,prop:"value"},{default:c((()=>[o(u,{clearable:"",autocomplete:"off",modelValue:f(M).info.value,"onUpdate:modelValue":a[4]||(a[4]=e=>f(M).info.value=e)},null,8,["modelValue"])])),_:1}),o(d,{label:"父级:","label-width":100,prop:"parentId"},{default:c((()=>[o(I,{modelValue:f(M).info.parentId,"onUpdate:modelValue":a[5]||(a[5]=e=>f(M).info.parentId=e),data:f(E),"check-strictly":"",filterable:"","render-after-expand":!1,style:{width:"100%"},props:{label:"name",value:"id",children:"children"}},null,8,["modelValue","data"])])),_:1}),"API"===f(M).info.type?(m(),p(d,{key:0,label:"请求类型:","label-width":100,prop:"method"},{default:c((()=>[o(V,{modelValue:f(M).info.method,"onUpdate:modelValue":a[6]||(a[6]=e=>f(M).info.method=e),placeholder:"请选择",clearable:""},{default:c((()=>[(m(!0),b(h,null,g(f(_),(e=>(m(),p(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):v("",!0),o(d,{label:"图标:","label-width":100,prop:"icon"},{default:c((()=>[o(u,{clearable:"",placeholder:"请输入图标类名 如 icon-home",autocomplete:"off",modelValue:f(M).info.icon,"onUpdate:modelValue":a[7]||(a[7]=e=>f(M).info.icon=e)},null,8,["modelValue"])])),_:1}),o(d,{label:"描述:","label-width":100,prop:"desc"},{default:c((()=>[o(u,{clearable:"",type:"textarea",maxlength:"100",placeholder:"请输入",autocomplete:"off",modelValue:f(M).info.desc,"onUpdate:modelValue":a[8]||(a[8]=e=>f(M).info.desc=e)},null,8,["modelValue"])])),_:1}),o(d,{"label-width":100,label:"扩展字段:",prop:"ext"},{default:c((()=>[y("div",C,[o(T,{value:f(M).info.ext,"onUpdate:value":a[9]||(a[9]=e=>f(M).info.ext=e),theme:"vs-dark",language:"json",options:S},null,8,["value"])])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])),_:1})}}});export{S as default};
