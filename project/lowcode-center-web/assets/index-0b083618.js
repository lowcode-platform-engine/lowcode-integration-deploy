import{d as e,f as a,r as l,a as t,M as s,o,i as n,j as d,n as u,w as r,q as i,l as c,m as p,k as y,a8 as f,a9 as h,at as m,aO as v,U as g,t as k,y as w,ax as C,_}from"./index-455b6c01.js";import{R as b,g as x,a as I,b as V,c as j}from"./index-5bcb12b6.js";const O={class:"left-content"},U={class:"left-content-type"},R={class:"input-group"},T={class:"custom-tree-node"},K={class:"footer-group"},B={style:{width:"100%",height:"100%"}},M=_(e({...e({name:"authorizationManage"}),setup(e){a();const _={automaticLayout:!0,formatOnType:!0,formatOnPaste:!0,language:"json",readOnly:!0},M=l(),P=t({type:"API",roleCode:"",authorityIds:[]}),q=l(""),z=l(""),A=l([]),J=l([]),L=l({label:"name",value:"id",children:"children"});s(q,(e=>{M.value.filter(e)})),s((()=>P.roleCode),(e=>{D()}));const N=(e,a)=>!e||a.label.includes(e),S=e=>{(async e=>{const a=await V({type:e});a.success?A.value=a.data:A.value=[]})(P.type)},W=async()=>{try{const e=await x();e.success&&e.data&&(J.value=e.data||[])}catch(e){}},D=async()=>{var e,a;try{if(!P.type||!P.roleCode)return;const l=await j({type:P.type,roleCode:P.roleCode});l.success&&l.data?(P.authorityIds=l.data.map((e=>e.id))||[],null==(a=null==(e=null==M?void 0:M.value)?void 0:e.setCheckedKeys)||a.call(e,P.authorityIds)):P.authorityIds=[]}catch(l){}};o((()=>{S(P.type),W()}));const E=async()=>{await S(P.type),await W(),await D()},F=()=>P.type?P.roleCode?(P.authorityIds.length||w.warning("当前选择的资源为空， 请注意"),void C.confirm("确定给当前角色授权?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{(await I({type:P.type,authorityIds:P.authorityIds,roleCode:P.roleCode})).success?(await D(),w({type:"success",message:"操作成功"})):w({type:"error",message:"操作失败"})}catch(e){}})).catch((()=>{w({type:"info",message:"操作取消"})}))):w.warning("请选择要授权的角色"):w.warning("请选择资源类型"),G=()=>{var e;null==(e=null==M?void 0:M.value)||e.setCheckedKeys([]),P.authorityIds=[]},H=(e,a)=>{P.authorityIds=a.checkedKeys||[]};return(e,a)=>{const l=n("el-radio-button"),t=n("el-radio-group"),s=n("el-option"),o=n("el-select"),w=n("el-input"),C=n("RefreshRight"),x=n("el-icon"),I=n("el-button"),V=n("el-divider"),j=n("el-col"),W=n("vue-monaco-editor"),D=n("el-row"),Q=n("t-layout-page-item"),X=n("t-layout-page");return d(),u(X,{class:"menu_mange"},{default:r((()=>[i(Q,{class:"content"},{default:r((()=>[i(D,{class:"row"},{default:r((()=>[i(j,{span:14,class:"left-col"},{default:r((()=>[c("div",O,[c("div",U,[i(t,{modelValue:p(P).type,"onUpdate:modelValue":a[0]||(a[0]=e=>p(P).type=e),onChange:S},{default:r((()=>[(d(!0),y(f,null,h(p(b),(e=>(d(),u(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),c("div",R,[i(w,{class:"tree-filter-input",modelValue:p(q),"onUpdate:modelValue":a[2]||(a[2]=e=>m(q)?q.value=e:null),placeholder:"请输入关键词"},{prepend:r((()=>[i(o,{modelValue:p(P).roleCode,"onUpdate:modelValue":a[1]||(a[1]=e=>p(P).roleCode=e),placeholder:"角色",style:{width:"115px",background:"#ffffff"}},{default:r((()=>[(d(!0),y(f,null,h(p(J),(e=>(d(),u(s,{label:e.name,value:e.code,key:e.code},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"]),i(I,{onClick:E,style:{"margin-left":"8px"}},{default:r((()=>[i(x,null,{default:r((()=>[i(C)])),_:1})])),_:1})]),i(p(v),{"highlight-current":!0,ref_key:"treeRef",ref:M,style:{"max-width":"600px"},"show-checkbox":"",class:"tree-filter-data","check-strictly":!0,"expand-on-click-node":!1,"default-expand-all":!1,"node-key":"id",onCheck:H,data:p(A),props:p(L),"filter-node-method":N},{default:r((({node:e,data:l})=>[c("span",T,[c("span",null,g(e.label),1),c("span",null,[i(I,{onClick:e=>(e=>{z.value=JSON.stringify(e,null,2)})(l),type:"primary",link:""},{default:r((()=>a[4]||(a[4]=[k(" 详情 ")]))),_:2},1032,["onClick"])])])])),_:1},8,["data","props"]),c("div",K,[i(I,{onClick:G},{default:r((()=>a[5]||(a[5]=[k("重置")]))),_:1}),i(I,{type:"primary",onClick:F},{default:r((()=>a[6]||(a[6]=[k("确认")]))),_:1})])]),i(V,{class:"divider",direction:"vertical"})])),_:1}),i(j,{span:10},{default:r((()=>[c("div",B,[i(W,{value:p(z),"onUpdate:value":a[3]||(a[3]=e=>m(z)?z.value=e:null),theme:"vs-dark",language:"json",options:_},null,8,["value"])])])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-ce666be4"]]);export{M as default};
