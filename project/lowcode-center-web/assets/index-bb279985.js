import{ar as e,as as a,d as l,f as o,r as t,a as r,o as d,F as s,i as u,j as c,n,w as i,q as m,l as p,t as w,m as v,U as y,B as f,at as g,k as h,a8 as b,a9 as _,D as k,y as C,_ as V}from"./index-455b6c01.js";function U(){return e({url:`${a}/lowcode-center-server/v1.0/openConfig/scope/list`,method:"post",params:{},data:{}})}const x={style:{cursor:"pointer"}},K={class:"appendCreateAccess"},q={class:"dialog-footer"},$=["src"],L={style:{flex:"auto"}},A=V(l({...l({name:"Applications"}),setup(l){o();const V=t(),A=t(!1),S=t(!1),j=t(""),D=t([]),N=t(!1),R=t(!1),Y=t([]),E=t({name:"",ownerCode:"",desc:"",callback:"",homeUrl:"",logo:"",scope:[]}),H=async e=>{if(e){R.value=!0,window.allowLoading=!1;const a=await k({page:1,pageSize:50,name:e});Y.value=(a.data.data||[]).map((e=>({label:`${e.name}(${e.nick})`,value:`${e.code}::${e.name}`}))),R.value=!1,window.allowLoading=!0}else Y.value=[]},I=()=>{const e=document.createElement("textarea");e.value=j.value,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),C.success("复制成功")},P=e=>["image/jpeg","image/png"].includes(e.type)?!(e.size/1024>10)||(C.error("不能大于10k"),!1):(C.error("Avatar picture must be JPG format!"),!1);const T=(e,a)=>{E.value.logo=URL.createObjectURL(e.raw)},z=r({name:[{required:!0,message:"平台名称不能为空",trigger:"blur"},{min:3,max:20,message:"长度不能大于20个字符",trigger:"blur"}],callback:[{required:!0,message:"不能为空",trigger:"blur"}],ownerCode:[{required:!0,message:"不能为空",trigger:"blur"}],homeUrl:[{required:!0,message:"不能为空",trigger:"blur"}],scope:[{required:!0,message:"请选择授权范围",trigger:"blur"}]}),B=t("rtl"),F=()=>{A.value=!1,S.value=!1,j.value="",N.value=!1},G=async()=>{var l,o;V.value&&await(null==(o=null==(l=null==V?void 0:V.value)?void 0:l.validate)?void 0:o.call(l,(async(l,o)=>{var t,r,d;if(l){const l=await(d=E.value.logo,new Promise((e=>{let a=new Image,l=document.createElement("canvas"),o=l.getContext("2d");a.crossOrigin="anonymous",a.onload=function(t){l.width=a.width,l.height=a.height,o.drawImage(a,0,0),e(l.toDataURL("image/jpeg",.5))},a.src=d})));if("string"==typeof l&&(E.value.logo=l),N.value){const l=await function(l){const o=l.ownerCode.split("::")||["",""];return e({url:`${a}/lowcode-center-server/v1.0/developer/updateAccess`,method:"post",params:{},data:{...l,ownerCode:o[0],ownerName:o[1]}})}({...E.value});await W(),C.success("操作成功"),j.value=(null==(t=null==l?void 0:l.data)?void 0:t.secretKey)||"",N.value=!1,A.value=!1,S.value=!0}else{const l=await function(l){const o=l.ownerCode.split("::")||["",""];return e({url:`${a}/lowcode-center-server/v1.0/developer/createAccess`,method:"post",params:{},data:{...l,ownerCode:o[0],ownerName:o[1]}})}({...E.value});await W(),C.success("操作成功"),j.value=(null==(r=null==l?void 0:l.data)?void 0:r.secretKey)||"",N.value=!1,S.value=!0}}})))},M=async l=>{try{await(o=Q.row.accessKey,e({url:`${a}/lowcode-center-server/v1.0/developer/dropAccess`,method:"post",params:{},data:{accessKey:o}}));C.success("操作成功")}catch(t){C.error("操作失败")}var o;W(),Q.show=!1,Q.row=null},O=async l=>{try{await(o=l.accessKey,e({url:`${a}/lowcode-center-server/v1.0/developer/deleteAccess`,method:"post",params:{},data:{accessKey:o}}));C.success("操作成功")}catch(t){C.error("操作失败")}var o;W()},J=r({query:{},table:{data:[]}}),Q=r({show:!1,row:null});d((()=>{W()}));const W=async l=>{const o=await e({url:`${a}/lowcode-center-server/v1.0/developer/accessList`,method:"post",params:{},data:{}});J.table.data=o.data&&o.data?o.data:[],J.table.data.forEach((e=>{e.crateTimeLabel=s(e.crateTime).format("YYYY-MM-DD HH:mm"),e.ownerCode&&e.ownerName&&(e.ownerCode=`${e.ownerCode}::${e.ownerName}`)}))},X=async()=>{try{const e=await U();E.value={name:"",ownerCode:"",desc:"",callback:"",homeUrl:"",logo:"",scope:[]},D.value=e.data,j.value="",A.value=!0,S.value=!1,N.value=!1}catch(e){C.error("操作失败，请联系客服")}};return(e,a)=>{const l=u("t-layout-page-item"),o=u("el-table-column"),t=u("el-link"),r=u("el-image"),d=u("el-input"),s=u("el-form-item"),k=u("View"),C=u("el-icon"),W=u("Hide"),Z=u("el-form"),ee=u("el-tag"),ae=u("el-button"),le=u("Plus"),oe=u("el-table"),te=u("el-dialog"),re=u("el-alert"),de=u("el-checkbox"),se=u("el-checkbox-group"),ue=u("el-option"),ce=u("el-select"),ne=u("el-upload"),ie=u("el-drawer"),me=u("t-layout-page");return c(),n(me,{class:"menu_mange"},{default:i((()=>[m(l,null,{default:i((()=>a[9]||(a[9]=[p("div",null,[w(" 出于安全考虑，建议您周期性地更换密钥。 "),p("br")],-1)]))),_:1}),m(l,null,{default:i((()=>[m(oe,{data:v(J).table.data,stripe:"",style:{width:"100%"}},{append:i((()=>[p("div",K,[m(ae,{type:"primary",onClick:X},{default:i((()=>[m(C,null,{default:i((()=>[m(le)])),_:1}),a[15]||(a[15]=w(" 新增 "))])),_:1})])])),default:i((()=>[m(o,{prop:"crateTimeLabel",label:"创建时间",width:"180"}),m(o,{prop:"name",label:"名称",width:"200"},{default:i((e=>[m(t,{type:"primary",href:e.row.homeUrl,target:"_blank"},{default:i((()=>[w(y(e.row.name),1)])),_:2},1032,["href"])])),_:1}),m(o,{prop:"logo",label:"Logo",width:"160"},{default:i((e=>[m(r,{style:{width:"100px",height:"100px"},src:e.row.logo},null,8,["src"])])),_:1}),m(o,{label:"AccessKey/SecretKey"},{default:i((e=>[m(Z,{"label-position":"right","label-width":"auto",model:e.row,style:{"max-width":"600px"}},{default:i((()=>[m(s,{label:"AccessKey"},{default:i((()=>[m(d,{modelValue:e.row.accessKey,"onUpdate:modelValue":a=>e.row.accessKey=a,readonly:"",style:{width:"340px"}},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),m(s,{label:"SecretKey"},{default:i((()=>[m(d,{modelValue:e.row.secretKey,"onUpdate:modelValue":a=>e.row.secretKey=a,readonly:"",type:e.row.showSecretKey?"text":"password",style:{width:"340px"}},{suffix:i((()=>[p("div",x,[e.row.showSecretKey?(c(),n(C,{key:0,onClick:()=>{e.row.showSecretKey=!1}},{default:i((()=>[m(k)])),_:2},1032,["onClick"])):(c(),n(C,{key:1,onClick:()=>{e.row.showSecretKey=!0}},{default:i((()=>[m(W)])),_:2},1032,["onClick"]))])])),_:2},1032,["modelValue","onUpdate:modelValue","type"])])),_:2},1024),m(s,{label:"Callback"},{default:i((()=>[m(d,{modelValue:e.row.callback,"onUpdate:modelValue":a=>e.row.callback=a,readonly:"",style:{width:"340px"}},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model"])])),_:1}),m(o,{prop:"desc",label:"备注",width:"180"}),m(o,{prop:"address",label:"状态",width:"140"},{default:i((e=>[1===e.row.status?(c(),n(ee,{key:0,type:"success"},{default:i((()=>a[10]||(a[10]=[w("生效中")]))),_:1})):(c(),n(ee,{key:1,type:"danger"},{default:i((()=>a[11]||(a[11]=[w("已停用")]))),_:1}))])),_:1}),m(o,{label:"操作",width:"240"},{default:i((e=>[p("div",null,[m(ae,{type:"danger",onClick:a=>{return l=e.row,Q.show=!0,void(Q.row=l);var l},disabled:0===e.row.status},{default:i((()=>a[12]||(a[12]=[w("停用")]))),_:2},1032,["onClick","disabled"]),m(ae,{type:"primary",onClick:a=>(async e=>{const a=await U();D.value=a.data,j.value="";const{logo:l,callback:o,homeUrl:t,name:r,desc:d,scopes:s=[],ownerCode:u}=e;N.value=!0,E.value={logo:l,callback:o,homeUrl:t,name:r,desc:d,scope:s,id:e.id,ownerCode:u};const c=(null==u?void 0:u.split("::"))||["",""];H(c[1]),A.value=!0,S.value=!1})(e.row)},{default:i((()=>a[13]||(a[13]=[w("编辑")]))),_:2},1032,["onClick"]),0===e.row.status?(c(),n(ae,{key:0,onClick:a=>O(e.row),type:"danger"},{default:i((()=>a[14]||(a[14]=[w("删除")]))),_:2},1032,["onClick"])):f("",!0)])])),_:1})])),_:1},8,["data"]),m(te,{modelValue:v(Q).show,"onUpdate:modelValue":a[1]||(a[1]=e=>v(Q).show=e),title:"您确定禁用此密钥吗？",width:"500px"},{footer:i((()=>[p("div",q,[m(ae,{onClick:a[0]||(a[0]=e=>v(Q).show=!1)},{default:i((()=>a[16]||(a[16]=[w("取消")]))),_:1}),m(ae,{type:"primary",onClick:M},{default:i((()=>a[17]||(a[17]=[w(" 确认 ")]))),_:1})])])),default:i((()=>[a[18]||(a[18]=p("span",null,"禁用前请确认该密钥没有被使用。",-1))])),_:1},8,["modelValue"])])),_:1}),m(ie,{modelValue:v(A),"onUpdate:modelValue":a[8]||(a[8]=e=>g(A)?A.value=e:null),direction:v(B),"destroy-on-close":!0},{header:i((()=>[p("div",null,y(v(N)?"编辑接入":"增加接入"),1)])),default:i((()=>[p("div",null,[v(j)?(c(),n(re,{key:0,title:"私钥已生成，请做好记录",type:"info",effect:"dark","close-text":"复制",class:"alert",onClose:I})):f("",!0),m(Z,{model:v(E),"label-width":"auto",rules:v(z),ref_key:"ruleFormRef",ref:V},{default:i((()=>[m(s,{prop:"name",label:"平台名称",required:""},{default:i((()=>[m(d,{modelValue:v(E).name,"onUpdate:modelValue":a[2]||(a[2]=e=>v(E).name=e)},null,8,["modelValue"])])),_:1}),m(s,{prop:"homeUrl",label:"应用地址",required:""},{default:i((()=>[m(d,{modelValue:v(E).homeUrl,"onUpdate:modelValue":a[3]||(a[3]=e=>v(E).homeUrl=e)},null,8,["modelValue"])])),_:1}),m(s,{prop:"callback",label:"回调地址",required:""},{default:i((()=>[m(d,{modelValue:v(E).callback,"onUpdate:modelValue":a[4]||(a[4]=e=>v(E).callback=e)},null,8,["modelValue"])])),_:1}),m(s,{prop:"scope",label:"授权"},{default:i((()=>[m(se,{modelValue:v(E).scope,"onUpdate:modelValue":a[5]||(a[5]=e=>v(E).scope=e),class:"checkboxGroup"},{default:i((()=>[(c(!0),h(b,null,_(v(D),(e=>(c(),n(de,{key:e.code,value:e.code,name:e.code},{default:i((()=>[w(y(e.name)+"（"+y(e.description||"")+"） ",1)])),_:2},1032,["value","name"])))),128))])),_:1},8,["modelValue"])])),_:1}),m(s,{prop:"ownerCode",label:"负责人",required:""},{default:i((()=>[m(ce,{modelValue:v(E).ownerCode,"onUpdate:modelValue":a[6]||(a[6]=e=>v(E).ownerCode=e),filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入用户名搜索","remote-method":H,loading:v(R)},{loading:i((()=>a[19]||(a[19]=[p("svg",{class:"circular",viewBox:"0 0 50 50"},[p("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)]))),default:i((()=>[(c(!0),h(b,null,_(v(Y),(e=>(c(),n(ue,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","loading"])])),_:1}),m(s,{prop:"logo",label:"Logo",required:""},{default:i((()=>[m(ne,{class:"avatar-uploader","before-upload":P,"on-change":T,"show-file-list":!1},{default:i((()=>[v(E).logo?(c(),h("img",{key:0,src:v(E).logo,class:"avatar"},null,8,$)):(c(),n(C,{key:1,class:"avatar-uploader-icon"},{default:i((()=>[m(le)])),_:1}))])),_:1})])),_:1}),m(s,{prop:"desc",label:"备注",required:""},{default:i((()=>[m(d,{type:"textarea",modelValue:v(E).desc,"onUpdate:modelValue":a[7]||(a[7]=e=>v(E).desc=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),footer:i((()=>[p("div",L,[m(ae,{onClick:F},{default:i((()=>a[20]||(a[20]=[w("取消")]))),_:1}),m(ae,{type:"primary",onClick:G,disabled:v(S)},{default:i((()=>a[21]||(a[21]=[w("确认")]))),_:1},8,["disabled"])])])),_:1},8,["modelValue","direction"])])),_:1})}}}),[["__scopeId","data-v-247a24fd"]]);export{A as default};
