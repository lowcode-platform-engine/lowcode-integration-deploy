import{r as a,y as e,d as t,f as s,u as l,o as n,i as c,j as r,n as o,w as u,q as i,l as d,t as m,k as v,a8 as y,a9 as p,m as f,U as h,am as w,G as _,_ as g}from"./index-455b6c01.js";import{S as C}from"./SchemaRender-0f9c0dff.js";import{g as V,s as S,a as k}from"./index-088e6ea1.js";import"./loader-421e4912.js";const j={class:"buttons"},B={class:"left"},O={class:"el-dropdown-link"},b=g(t({...t({name:"BootConfig"}),setup(t){s();const g=a(),b=a(""),z=a([]),R=async()=>{var a,e;try{await(null==(e=(a=g.value).reset)?void 0:e.call(a))}catch(t){}},x=async a=>{var e,t;try{await(null==(t=(e=g.value).setValues)?void 0:t.call(e,a))}catch(s){}},G=l();n((async()=>{}));const{getConfigSchema:I,setBizValue:L,getBizValue:N}=(t=>{const s=a();return{getConfigSchema:async()=>{var a;try{const e=await V(t,{versionList:!0});return e.success?(s.value=null==(a=e.data)?void 0:a.id,e.data?{schema:JSON.parse(e.data.schema),id:e.data.id,history:e.data.history||[]}:{}):{}}catch(e){return{}}},setBizValue:async(a,t)=>{try{return(await S({id:s.value||t,value:a})).success?(e.success("操作成功"),!0):(e.error("系统异常，数据加载失败"),!1)}catch(l){return!1}},getBizValue:async(a={})=>{var l;try{const n=await k(t,a);return n.success?(s.value=null==(l=n.data)?void 0:l.id,n.data||{}):(e.error("系统异常，数据加载失败"),{})}catch(n){return{}}}}})(G.meta.schemaCode||"OAUTH-USER-LOGIN-CONFIG"),U=async()=>{var a,e;try{const t=await(null==(e=(a=g.value).save)?void 0:e.call(a));await L(t,A.value)}catch(t){}},A=a(),M=()=>{_((async()=>{const{schema:a,id:e,history:t=[]}=await I();z.value=t,A.value=e;const s=await N();await(async a=>{var e,t;try{await(null==(t=(e=g.value).setSchema)?void 0:t.call(e,a))}catch(s){}})(a),await x(s)}))},q=async a=>{b.value=a;const t=await N({version:a});await x(t),e({message:`已经回填历史版本 ${a} 的数据， 保存生成新本版本数据`,type:"success"})};return(a,e)=>{const t=c("t-layout-page-item"),s=c("el-icon"),l=c("el-dropdown-item"),n=c("el-dropdown-menu"),_=c("el-dropdown"),V=c("el-button"),S=c("t-layout-page");return r(),o(S,{class:"menu_mange"},{default:u((()=>[i(t,null,{default:u((()=>e[0]||(e[0]=[d("div",null,[m(" 当系统私有化部署时，需要配置三方登录的基本信息，支持 OAuth2.0协议 "),d("br")],-1)]))),_:1}),i(t,{class:"content"},{default:u((()=>[d("div",j,[d("div",B,[i(_,{onCommand:q},{dropdown:u((()=>[i(n,null,{default:u((()=>[(r(!0),v(y,null,p(f(z),(a=>(r(),o(l,{command:a.templateVersion,key:a.templateVersion},{default:u((()=>[m(h(a.templateVersion),1)])),_:2},1032,["command"])))),128))])),_:1})])),default:u((()=>[d("span",O,[m(h(f(b)||"新版本")+" ",1),i(s,{class:"el-icon--right"},{default:u((()=>[i(f(w))])),_:1})])])),_:1})]),d("div",null,[i(V,{onClick:R},{default:u((()=>e[1]||(e[1]=[m("重置表单")]))),_:1}),i(V,{type:"primary",onClick:U},{default:u((()=>e[2]||(e[2]=[m("保存配置")]))),_:1})])]),i(C,{ref_key:"schemaRenderRef",ref:g,onMounted:M},null,512)])),_:1})])),_:1})}}}),[["__scopeId","data-v-6e102b45"]]);export{b as default};
