import{d as e,f as a,a as l,r as o,q as s,i as t,t as r,C as d,o as n,D as i,F as u,j as c,n as m,w as p,m as f,l as b,k as g,a8 as w,a9 as h,aL as y,y as V,G as k,aM as v,aN as _}from"./index-455b6c01.js";import{g as P}from"./index-5bcb12b6.js";const C={class:"dialog-footer"},x={class:"dialog-footer"},I={class:"dialog-footer"},U={class:"dialog-footer"},L=e({...e({name:"accountManageList"}),setup(e){a();const L=l({info:{},show:!1}),q=o(),R=o(),F=o(),S=l({info:{name:"",nick:"",password:"",rePassword:""},rules:{name:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:16,message:"用户名必须要在4到16位之间",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],rePassword:[{required:!0,message:"请输入确认密码",trigger:"blur"},{validator:(e,a,l)=>{a!==S.info.password&&l(new Error("重复密码错错误")),l()},trigger:"blur"}]},show:!1}),T=l({info:{nick:"",code:"",roleId:"",id:""},rules:{},show:!1}),z=o([]),W=l({info:{status:"",code:"",statusReason:""},statusList:[{value:0,label:"正常"},{value:1,label:"手动禁用"},{value:2,label:"自动风控"}],rules:{status:[{required:!0,message:"状态不能为空",trigger:"blur"}]},show:!1}),E=()=>{S.info={name:"",nick:"",password:"",rePassword:""}},M=()=>{S.show=!0,k((()=>{S.info={name:"",nick:"",password:"",rePassword:""}}))},N=()=>{T.info={nick:"",code:"",id:"",roleId:""}},A=()=>{W.info={code:"",status:"",statusReason:""}},Y=e=>{G.table.pageSize=e,J()},j=e=>{G.table.currentPage=e,J()},D=()=>{L.show=!1},H=()=>{L.show=!1},G=l({query:{name:"",roleId:"",emailL:"",nick:"",startAge:"",endAge:"",orgId:"",platform:"",code:""},table:{total:0,pageSize:10,currentPage:1,data:[],columns:[{prop:"avatarUrl",label:"头像",minWidth:120,render:(e,a)=>s(t("el-avatar"),{shape:"square",size:"100",fit:"fit",src:a.avatarUrl},null)},{prop:"name",label:"用户名",minWidth:120},{prop:"nick",label:"昵称",minWidth:120},{prop:"roleName",label:"角色",minWidth:120},{prop:"status",label:"状态",minWidth:120,render:(e,a)=>0===e?s(t("el-button"),{link:!0,type:"success"},{default:()=>[r("正常")]}):s(t("el-button"),{link:!0,type:"danger"},{default:()=>[r("异常")]})},{prop:"crateTimeLabel",label:"创建时间",minWidth:140}],operator:[{text:"编辑",fun:e=>{var a;T.show=!0,T.info={nick:e.nick,id:e.id,roleId:null==(a=null==e?void 0:e.role)?void 0:a.id,code:e.code}}},{text:"状态",fun:e=>{W.show=!0,k((()=>{W.info={code:e.code,status:e.status,statusReason:e.statusReason}}))}},{text:"删除",disabled:!0,fun:e=>{}}],operatorConfig:{fixed:"right",align:"center",width:"160",label:"操作"}},listTypeInfo:{platformList:[{dictLabel:"微信小程序",dictValue:"WX"},{dictLabel:"PC",dictValue:"PC"},{dictLabel:"APP",dictValue:"APP"}]}}),X=d((()=>({name:{label:"用户名",comp:"el-input"},nick:{label:"昵称",comp:"el-input"},platform:{label:"注册平台",comp:"el-select",changeEvent:"change",type:"select-arr",list:"platformList",listTypeInfo:G.listTypeInfo}}))),B=e=>{G.query={...G.query,...e},J("search")};n((()=>{J(),P().then((e=>{e.success&&(z.value=e.data.map((e=>({label:e.name,value:e.id}))))}))}));const J=async e=>{"search"==e&&(G.table.currentPage=1);const a=await i({...G.query,page:G.table.currentPage,pageSize:G.table.pageSize,name:G.query.name});G.table.total=a.data&&a.data.count||0,G.table.data=a.data&&a.data.data?a.data.data:[],G.table.data.forEach((e=>{e.roleName=(null==e?void 0:e.role.name)||"--",e.statusLabel=0===e.status?"正常":"异常",e.crateTimeLabel=u(Number(e.crateTime)).format("YYYY-MM-DD HH:mm")}));const l=Math.ceil(G.table.total/G.table.pageSize);return l<G.table.currentPage&&0!==G.table.total?(G.table.currentPage=l,J()):0===G.table.total&&(G.table.currentPage=1),!1};return(e,a)=>{const l=t("t-query-condition"),o=t("t-layout-page-item"),d=t("el-button"),n=t("t-table"),i=t("el-dialog"),u=t("el-input"),k=t("el-form-item"),P=t("el-form"),K=t("el-option"),O=t("el-select"),Q=t("t-layout-page");return c(),m(Q,{class:"menu_mange"},{default:p((()=>[s(o,null,{default:p((()=>[s(l,{opts:f(X),onSubmit:B},null,8,["opts"])])),_:1}),s(o,null,{default:p((()=>[s(n,{title:"用户管理列表",table:f(G).table,columns:f(G).table.columns,onSizeChange:Y,onPageChange:j},{toolbar:p((()=>[s(d,{type:"primary",onClick:M},{default:p((()=>a[18]||(a[18]=[r("新增")]))),_:1})])),_:1},8,["table","columns"])])),_:1}),s(i,{class:"custom-class-message-info-dialog",modelValue:f(L).show,"onUpdate:modelValue":a[0]||(a[0]=e=>f(L).show=e),title:"会员等级",width:"500px",draggable:"","destroy-on-close":"","show-close":!1,top:"100px"},{footer:p((()=>[b("span",C,[s(d,{onClick:D},{default:p((()=>a[19]||(a[19]=[r("取消")]))),_:1}),s(d,{type:"primary",onClick:H},{default:p((()=>a[20]||(a[20]=[r("确认")]))),_:1})])])),default:p((()=>[a[21]||(a[21]=b("span",null,"This is userInfo",-1))])),_:1},8,["modelValue"]),s(i,{class:"custom-class-message-info-dialog",modelValue:f(S).show,"onUpdate:modelValue":a[7]||(a[7]=e=>f(S).show=e),title:"创建用户",width:"500px",draggable:"","destroy-on-close":"","show-close":!1,top:"100px",onClose:E},{footer:p((()=>[b("span",x,[s(d,{onClick:a[5]||(a[5]=e=>(f(q).resetFields(),void(S.show=!1)))},{default:p((()=>a[22]||(a[22]=[r("取消")]))),_:1}),s(d,{type:"primary",onClick:a[6]||(a[6]=e=>{var a;(a=f(q))&&a.validate((async e=>{if(!e)return!1;{const e=await y({userName:S.info.name,nick:S.info.nick,password:S.info.password});e.success?(V.success("创建成功"),a.resetFields(),J("search"),S.show=!1):V.error(e.message||"系统错误")}}))})},{default:p((()=>a[23]||(a[23]=[r("确认")]))),_:1})])])),default:p((()=>[s(P,{model:f(S).info,rules:f(S).rules,ref_key:"ruleFormRef",ref:q},{default:p((()=>[s(k,{label:"用户名:","label-width":100,prop:"name"},{default:p((()=>[s(u,{modelValue:f(S).info.name,"onUpdate:modelValue":a[1]||(a[1]=e=>f(S).info.name=e)},null,8,["modelValue"])])),_:1}),s(k,{label:"昵称:","label-width":100,prop:"nick"},{default:p((()=>[s(u,{modelValue:f(S).info.nick,"onUpdate:modelValue":a[2]||(a[2]=e=>f(S).info.nick=e)},null,8,["modelValue"])])),_:1}),s(k,{label:"密码:","label-width":100,prop:"password"},{default:p((()=>[s(u,{modelValue:f(S).info.password,"onUpdate:modelValue":a[3]||(a[3]=e=>f(S).info.password=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),s(k,{label:"确认密码:","label-width":100,prop:"rePassword"},{default:p((()=>[s(u,{modelValue:f(S).info.rePassword,"onUpdate:modelValue":a[4]||(a[4]=e=>f(S).info.rePassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),s(i,{class:"custom-class-message-info-dialog",modelValue:f(T).show,"onUpdate:modelValue":a[12]||(a[12]=e=>f(T).show=e),title:"编辑用户",width:"500px",draggable:"","destroy-on-close":"","show-close":!1,top:"100px",onClose:N},{footer:p((()=>[b("span",I,[s(d,{onClick:a[10]||(a[10]=e=>{return null==(a=f(R))||a.resetFields(),void(T.show=!1);var a})},{default:p((()=>a[24]||(a[24]=[r("取消")]))),_:1}),s(d,{type:"primary",onClick:a[11]||(a[11]=e=>{var a;(a=f(R))&&a.validate((async e=>{if(!e)return!1;{const e=await _({id:T.info.id,code:T.info.code,list:[{type:"nick",value:T.info.nick},{type:"roleId",value:T.info.roleId}]});e.success?(V.success("编辑成功"),a.resetFields(),J("search"),T.show=!1):V.error(e.message||"系统错误")}}))})},{default:p((()=>a[25]||(a[25]=[r("确认")]))),_:1})])])),default:p((()=>[s(P,{model:f(T).info,rules:f(T).rules,ref_key:"ruleFormEditRef",ref:R},{default:p((()=>[s(k,{label:"昵称:","label-width":100,prop:"nick"},{default:p((()=>[s(u,{modelValue:f(T).info.nick,"onUpdate:modelValue":a[8]||(a[8]=e=>f(T).info.nick=e)},null,8,["modelValue"])])),_:1}),s(k,{label:"角色:","label-width":100,prop:"roleId"},{default:p((()=>[s(O,{modelValue:f(T).info.roleId,"onUpdate:modelValue":a[9]||(a[9]=e=>f(T).info.roleId=e),style:{width:"100%"}},{default:p((()=>[(c(!0),g(w,null,h(f(z),(e=>(c(),m(K,{value:e.value,label:e.label,key:e.value},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),s(i,{class:"custom-class-message-info-dialog",modelValue:f(W).show,"onUpdate:modelValue":a[17]||(a[17]=e=>f(W).show=e),title:"标记状态",width:"500px",draggable:"","destroy-on-close":"","show-close":!1,top:"100px",onClose:A},{footer:p((()=>[b("span",U,[s(d,{onClick:a[15]||(a[15]=e=>(f(F).resetFields(),void(W.show=!1)))},{default:p((()=>a[26]||(a[26]=[r("取消")]))),_:1}),s(d,{type:"primary",onClick:a[16]||(a[16]=e=>{var a;(a=f(F))&&a.validate((async e=>{if(!e)return!1;{const e=await v({code:W.info.code,status:W.info.status,statusReason:W.info.statusReason});e.success?(V.success("标记成功"),a.resetFields(),J("search"),W.show=!1):V.error(e.message||"系统错误")}}))})},{default:p((()=>a[27]||(a[27]=[r("确认")]))),_:1})])])),default:p((()=>[s(P,{model:f(W).info,rules:f(W).rules,ref_key:"ruleSignFormEditRef",ref:F},{default:p((()=>[s(k,{label:"状态备注:","label-width":100,prop:"status"},{default:p((()=>[s(O,{modelValue:f(W).info.status,"onUpdate:modelValue":a[13]||(a[13]=e=>f(W).info.status=e),style:{width:"100%"}},{default:p((()=>[(c(!0),g(w,null,h(f(W).statusList,(e=>(c(),m(K,{value:e.value,label:e.label,key:e.value},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(k,{label:"状态备注:","label-width":100,prop:"nick"},{default:p((()=>[s(u,{modelValue:f(W).info.statusReason,"onUpdate:modelValue":a[14]||(a[14]=e=>f(W).info.statusReason=e),type:"textarea",rows:"3"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])),_:1})}}});export{L as default};
