import{d as e,f as a,C as t,a as l,q as o,i as r,t as n,o as s,ae as i,F as u,j as c,n as d,w as p,m,N as g,l as b,U as f,Z as h,H as y,V as w,af as v,y as _,X as q,ag as I,_ as V}from"./index-455b6c01.js";import{i as x}from"./version-078b84e2.js";const P={class:"text-large font-600 mr-3"},T={class:"dialog-footer"},C={class:"dialog-footer"};const S=V(e({...e({name:"pagePublishLog"}),setup(e){const V=a();let{proxy:S}=y();const k=t((()=>S.$route.query.name)),M=l({show:!1,schemaInfo:{}}),z=e=>{D.table.pageSize=e,H()},L=e=>{D.table.currentPage=e,H()},$=async()=>{w();try{const e=x(D.table.data[0].version,"patch"),a=await v(S.$route.query.id,e);a.success?(H("search"),_({type:"success",message:"操作成功"})):_({type:"error",message:a.message||a.errorMessage||"系统错误"})}catch(e){_({type:"error",message:e.message||e.errorMessage||"系统错误"})}q()},j=e=>{E.show=!1,E.row=null},W=async e=>{w();try{const e=await I(O.row.ossKey,S.$route.query.pageId);O.show=!1,e.success?_({type:"success",message:"操作成功,稍后请在下载中心查看"}):_({type:"error",message:e.errorMessage||"系统错误"})}catch(a){_({type:"error",message:"系统错误"})}q()},D=l({query:{pageVersionId:S.$route.query.id,pageId:S.$route.query.pageId,version:"",env:""},table:{total:0,pageSize:10,currentPage:1,data:[],columns:[{prop:"id",label:"Id",width:80,render:(e,a)=>e||"--"},{prop:"version",label:"版本",minWidth:120,render:(e,a)=>{return o(r("el-button"),{link:!0,type:"''"},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!h(t)?e:{default:()=>[e]});var t}},{prop:"committer",label:"操作者",minWidth:120,render:(e,a)=>e||"--"},{prop:"name",label:"页面信息",minWidth:120,render:(e,a)=>o("div",null,[o(r("el-button"),{type:"primary",link:!0,onClick:()=>(e=>{V.push({path:"/atomManagement/pageManage/info",query:{id:e.pageId,name:S.$route.query.name}})})(a)},{default:()=>[S.$route.query.name]})])},{prop:"env",label:"发布环境",render:(e,a)=>{const t={EDIT_ING:"info",TEST:"primary",PROD:"success"}[null==a?void 0:a.env]||"info";return-1===a.status?o(r("el-tag"),{effect:"light",type:"info"},{default:()=>[n("已下线")]}):o(r("el-tag"),{effect:"light",type:t},{default:()=>[a.envName||a.env]})}},{prop:"crateTimeLabel",label:"发布时间",minWidth:140}],operator:[{text:"下载资源包",fun:e=>{O.show=!0,O.row=e}}],operatorConfig:{fixed:"right",align:"center",width:"120",label:"操作"}},listTypeInfo:{envList:[{dictLabel:"测试环境",dictValue:"TEST"},{dictLabel:"生产环境",dictValue:"PROD"}]}}),E=l({show:!1,row:null});l({show:!1,row:null}),l({show:!1,row:null});const O=l({show:!1,row:null}),U=t((()=>({version:{label:"版本",comp:"el-input",bind:{clearable:!0}},env:{label:"发布环境",comp:"el-select",changeEvent:"change",type:"select-arr",list:"envList",listTypeInfo:D.listTypeInfo}}))),Y=e=>{D.query={...D.query,...e},H("search")};s((()=>{H()}));const H=async e=>{"search"==e&&(D.table.currentPage=1);const a=await i({...D.query,page:D.table.currentPage,pageSize:D.table.pageSize});D.table.total=a.data&&a.data.count||0,D.table.data=a.data&&a.data.data?a.data.data:[],D.table.data.forEach((e=>{e.crateTimeLabel=u(e.crateTime).format("YYYY-MM-DD HH:mm")}));const t=Math.ceil(D.table.total/D.table.pageSize);return t<D.table.currentPage&&0!==D.table.total?(D.table.currentPage=t,H()):0===D.table.total&&(D.table.currentPage=1),!1};return(e,a)=>{const t=r("el-page-header"),l=r("t-query-condition"),s=r("t-layout-page-item"),i=r("el-button"),u=r("el-popconfirm"),h=r("t-table"),y=r("el-dialog"),w=r("JsonViewer"),v=r("el-scrollbar"),_=r("el-drawer"),q=r("t-layout-page");return c(),d(q,{class:"page_manage_container"},{default:p((()=>[o(s,null,{default:p((()=>[o(t,{onBack:a[0]||(a[0]=()=>m(g)(m(V)))},{content:p((()=>a[6]||(a[6]=[b("span",{class:"text-large font-600 mr-3"}," 发布记录 ",-1)]))),_:1}),o(l,{opts:U.value,onSubmit:Y},null,8,["opts"])])),_:1}),o(s,null,{default:p((()=>[o(h,{table:m(D).table,columns:m(D).table.columns,onSizeChange:z,onPageChange:L},{toolbar:p((()=>[o(u,{width:"180","confirm-button-text":"确定","cancel-button-text":"取消",title:"确定要新建一个版本?",onConfirm:$},{reference:p((()=>[o(i,{type:"primary"},{default:p((()=>a[7]||(a[7]=[n("新建版本")]))),_:1})])),_:1})])),title:p((()=>[b("span",P,f(k.value),1)])),_:1},8,["table","columns"]),o(y,{size:"small",modelValue:m(E).show,"onUpdate:modelValue":a[2]||(a[2]=e=>m(E).show=e),"align-center":"",title:"Warning",width:"500px"},{footer:p((()=>[b("div",T,[o(i,{onClick:a[1]||(a[1]=e=>m(E).show=!1)},{default:p((()=>a[8]||(a[8]=[n("取消")]))),_:1}),o(i,{type:"primary",onClick:j},{default:p((()=>a[9]||(a[9]=[n(" 确认 ")]))),_:1})])])),default:p((()=>[a[10]||(a[10]=b("span",null,"确定要删除该页面？",-1))])),_:1},8,["modelValue"]),o(y,{modelValue:m(O).show,"onUpdate:modelValue":a[4]||(a[4]=e=>m(O).show=e),"align-center":"",title:"Warning",width:"500px"},{footer:p((()=>[b("div",C,[o(i,{onClick:a[3]||(a[3]=e=>m(O).show=!1)},{default:p((()=>a[11]||(a[11]=[n("取消")]))),_:1}),o(i,{type:"primary",onClick:W},{default:p((()=>a[12]||(a[12]=[n(" 确认 ")]))),_:1})])])),default:p((()=>[a[13]||(a[13]=b("span",null,"确定下载资源包？",-1))])),_:1},8,["modelValue"])])),_:1}),o(_,{"append-to-body":!0,"with-header":!1,modelValue:m(M).show,"onUpdate:modelValue":a[5]||(a[5]=e=>m(M).show=e),title:k.value},{default:p((()=>[o(v,null,{default:p((()=>[o(w,{expanded:!0,value:m(M).schemaInfo,copyable:"",boxed:"",sort:"",theme:"dark"},null,8,["value"])])),_:1})])),_:1},8,["modelValue","title"])])),_:1})}}}),[["__scopeId","data-v-4759cb59"]]);export{S as default};
