import{d as e,r as a,f as t,I as r,C as s,a as l,q as o,t as n,i,J as u,L as m,M as c,o as p,K as d,j as f,n as b,w as g,m as y,N as h,l as v,k as w,O as I,H as x,y as N,P as L,Q as C,R as T,S as D,_ as z}from"./index-455b6c01.js";import{u as q,g as k}from"./index-6d1bc2c2.js";class ${static convertToCamelCase(e){const a=e.toLowerCase().replace(/[_-]([a-z])/g,((e,a)=>a.toUpperCase()));return $.capitalizeFirstLetter(a)}static capitalizeFirstLetter(e){return e.replace(/^\w/,(e=>e.toUpperCase()))}static convertCamelCaseToKebabCase(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}const _=["src"],E=z(e({...e({name:"componentManagementInfo"}),setup(e){const z=a(),E=t();let{proxy:K}=x();const R=a(q),B=a({Authorization:`Bearer ${r()||""}`}),S=(e,a,t)=>{N.success("文件上传成功");t.every((e=>"success"===e.status))&&(O.otherInfo.opts.formData.thumb=e.data.url)},A=a(null),M=async e=>{if(K.$route.query.id){const a={...e.baseInfo,...e.otherInfo,id:K.$route.query.id};L(a).then((e=>{e.success?(N({type:"success",message:"更新成功"}),U()):N({type:"error",message:e.message||"系统错误"})})).catch((e=>{N({type:"error",message:e.message||"系统错误"})}))}else{const a={...e.baseInfo,...e.otherInfo,id:K.$route.query.id};C(a).then((e=>{e.success?(N({type:"success",message:"创建成功"}),h(E)):N({type:"error",message:e.message||"系统错误"})})).catch((e=>{N({type:"error",message:e.message||"系统错误"})}))}},j=s((()=>{var e,a,t;return K.$route.query.name?K.$route.query.name:null==(t=null==(a=null==(e=null==O?void 0:O.baseInfo)?void 0:e.opts)?void 0:a.formData)?void 0:t.name})),F=s((()=>!!K.$route.query.id));s((()=>1===O.baseInfo.opts.formData.destructuring));const O=l({baseInfo:{title:"基本信息",disabled:!0,name:"baseInfo",ref:null,widthSize:1,opts:{formData:{id:`${Math.floor(10*Math.random()+1)}`,name:null,type:null,alias:null,exportName:null,componentName:null,destructuring:0,category:null,sceneType:null,bizCode:[],author:null},fieldList:[{width:"50vw",value:"name",type:"input",comp:"el-input",event:"name",maxLength:50,bind:{disabled:F},placeholder:"请输入组件名称， 如站点 common-nav",labelRender:()=>o("span",{style:"display: flex; align-items: center;"},[n("组件名称"),o(i("el-tooltip"),{className:"box-item",effect:"dark",content:"组件名必须符合 npm 包名规范",placement:"top"},{default:()=>[o(i("el-icon"),{style:"margin-left: 4px"},{default:()=>[o(u,null,null)]})]})])},{value:"alias",type:"el-input",comp:"el-input",width:"50vw",maxLength:50,placeholder:"请输入组件别名， 如站点通用导航",labelRender:()=>o("span",{style:"display: flex; align-items: center;"},[n("组件别名"),o(i("el-tooltip"),{className:"box-item",effect:"dark",content:"主要用于描述组件的用途",placement:"top"},{default:()=>[o(i("el-icon"),{style:"margin-left: 4px"},{default:()=>[o(u,null,null)]})]})])},{label:"组件包名",value:"componentName",type:"el-input",comp:"el-input",width:"50vw",maxLength:50,placeholder:"请输入组件包名， 如 CommonNav",bind:{disabled:!0},labelRender:()=>o("span",{style:"display: flex; align-items: center;"},[n("组件包名"),o(i("el-tooltip"),{className:"box-item",effect:"dark",content:"最后消费的组件名称",placement:"top"},{default:()=>[o(i("el-icon"),{style:"margin-left: 4px"},{default:()=>[o(u,null,null)]})]})])},{label:"是否解构",value:"destructuring",type:"el-switch",comp:"el-switch",bind:{disabled:F,activeValue:1,inactiveValue:0},labelRender:()=>o("span",{style:"display: flex; align-items: center;"},[n("是否解构"),o(i("el-tooltip"),{className:"box-item",effect:"dark",content:"是不是有父级依赖，如 Antd 中的 Button 组件依赖 Antd 组件库",placement:"top"},{default:()=>[o(i("el-icon"),{style:"margin-left: 4px"},{default:()=>[o(u,null,null)]})]})])},{label:"解构依赖",width:"50vw",value:"exportName",type:"select-arr",comp:"el-select",list:"exportNameList",bind:e=>({disabled:0===e.destructuring}),arrLabel:"label",arrKey:"value"},{label:"物料类型",width:"50vw",value:"type",type:"select-arr",comp:"el-select",list:"materialType",arrLabel:"label",arrKey:"value",bind:{disabled:F}},{label:"场景类型",width:"50vw",value:"sceneType",type:"select-arr",comp:"el-select",list:"sceneTypeList",bind:{disabled:!1},arrLabel:"label",arrKey:"value"},{label:"物料分类",width:"50vw",value:"category",type:"select-arr",comp:"el-select",list:"categoryList",bind:{disabled:!1},arrLabel:"label",arrKey:"value"},{label:"业务归属",value:"bizCode",width:"50vw",type:"select-arr",comp:"el-select",list:"bizList",bind:{disabled:!1,multiple:!0,filterable:!0,clearable:!0,multipleLimit:2},arrLabel:"label",arrKey:"value"}],listTypeInfo:{sceneTypeList:[],bizList:[],categoryList:[],exportNameList:[],materialType:[]},rules:{name:[{required:!0,message:"请输入组件名称",trigger:"blur"},{trigger:"blur",validator:async(e,a,t)=>{if(!a)return t(new Error("请输入组件名称"));if(a.length>50)return t(new Error("组件名称不能超过50字符"));if(!/^(?!.*\.\.)(?!npm)[a-z0-9][a-z0-9-.]*[a-z0-9]$/.test(a))return t(new Error("名称必须符合 npm 包名规范"));try{if(F.value)return t();return(await m("name",a)).data?t():t(new Error("组件已存在，请更换"))}catch(r){return t(new Error("系统异常，请稍后重试"))}}}],alias:[{required:!0,message:"请输入组件别名",trigger:"blur"},{trigger:"blur",validator:async(e,a,t)=>a?a.length>50?t(new Error("组件别名不能超过50字符")):t():t(new Error("请输入组件别名"))}],libName:[{required:!0,message:"请输入组件包名",trigger:"blur"},{max:50,message:"组件包名不能超过50字符",trigger:"blur"},{trigger:"blur",validator:async(e,a,t)=>{if(!a)return t(new Error("请输入组件名称"));if(a.length>50)return t(new Error("组件名称不能超过50字符"));try{if(F.value)return t();return(await m("libName",a)).data?t():t(new Error("该包名已存在，请更换"))}catch(r){return t(new Error("系统异常，请稍后重试"))}}}],exportName:[{validator:async(e,a,t)=>(0===O.baseInfo.opts.formData.destructuring&&(O.baseInfo.opts.formData.exportName=O.baseInfo.opts.formData.componentName),1!==O.baseInfo.opts.formData.destructuring||a?(a||(O.baseInfo.opts.formData.exportName=O.baseInfo.opts.formData.componentName),t()):t(new Error("解构依赖不能为空")))}],author:[{max:10,message:"负责人不能超过10字符",trigger:"blur"}],sceneType:[{required:!0,message:"场景类型不能为空",trigger:"blur"}],category:[{required:!0,message:"分类不能为空",trigger:"blur"}],bizCode:[{required:!0,message:"业务归属不能为空",trigger:"blur"}],type:[{required:!0,message:"物料类型不能为空",trigger:"blur"}]}}},otherInfo:{title:"其他信息",name:"otherInfo",disabled:!0,widthSize:1,opts:{formData:{desc:null,thumb:"https://qiniu.canyuegongzi.xyz/lowcode_component/static/normal-component-logo.png"},fieldList:[{label:"组件描述",value:"desc",type:"textarea",comp:"el-input",width:"50vw"},{label:"缩略图",value:"thumb",width:"50vw",slotName:"thumb"}],listTypeInfo:{},rules:{domain:[{required:!0,message:"域名不能为空",trigger:"blur"}]}}}});c((()=>{var e,a,t;return null==(t=null==(a=null==(e=null==O?void 0:O.baseInfo)?void 0:e.opts)?void 0:a.formData)?void 0:t.name}),(e=>{const a=$.convertCamelCaseToKebabCase(e);O.baseInfo.opts.formData.componentName=$.convertToCamelCase(a),0===O.baseInfo.opts.formData.destructuring&&(O.baseInfo.opts.formData.exportName=O.baseInfo.opts.formData.componentName)}));const U=()=>{D(K.$route.query.id).then((e=>{if(e.success){const{data:a}=e;O.baseInfo.opts.formData={...O.baseInfo.opts.formData,name:a.name,alias:a.alias,author:a.author,category:a.category,sceneType:a.sceneType,type:a.type,componentName:a.componentName,destructuring:a.destructuring,exportName:a.exportName,bizCode:a.bizCode.split(",")},O.otherInfo.opts.formData={...O.otherInfo.opts.formData,desc:a.desc,thumb:a.thumb}}}))};return p((()=>{if((async()=>{const e=await k("material");if(e.success){const{materialBizConfig:a=[],materialCategoryConfig:t=[],materialSceneConfig:r=[],materialTypeConfig:s=[]}=e.data||{};O.baseInfo.opts.listTypeInfo.sceneTypeList=(r||[]).map((e=>({key:e.value,...e}))),O.baseInfo.opts.listTypeInfo.bizList=(a||[]).map((e=>({key:e.value,...e}))),O.baseInfo.opts.listTypeInfo.categoryList=(t||[]).map((e=>({key:e.value,...e}))),O.baseInfo.opts.listTypeInfo.materialType=(s||[]).map((e=>({key:e.value,...e})))}const a=await T();O.baseInfo.opts.listTypeInfo.exportNameList=(a.data||[]).map((e=>({key:e.componentName,label:`${e.alias}(${e.exportName})`,value:e.componentName,...e})))})(),K.$route.query.id)U();else{const e=window.localStorage.getItem(d.userName);O.baseInfo.opts.formData.author=e}})),(e,a)=>{const t=i("el-page-header"),r=i("el-icon"),s=i("el-upload"),l=i("t-module-form"),n=i("t-layout-page-item"),u=i("t-layout-page");return f(),b(u,{class:"page_manage_container"},{default:g((()=>[o(n,null,{default:g((()=>[o(t,{onBack:a[0]||(a[0]=()=>y(h)(y(E)))},{content:g((()=>a[1]||(a[1]=[v("span",{class:"text-large font-600 mr-3"}," 组件元数据 ",-1)]))),_:1}),o(l,{subTitle:j.value,ref_key:"sourceForm",ref:A,titleBold:"",formOpts:y(O),submit:M},{thumb:g((()=>[o(s,{class:"thumb-uploader",ref_key:"uploadRef",ref:z,action:y(R),data:{biz:"111",bucketType:"cdn"},headers:y(B),"on-success":S,"show-file-list":!1},{default:g((()=>[y(O).otherInfo.opts.formData.thumb?(f(),w("img",{key:0,src:y(O).otherInfo.opts.formData.thumb,class:"avatar"},null,8,_)):(f(),b(r,{key:1,class:"avatar-uploader-icon"},{default:g((()=>[o(y(I))])),_:1}))])),_:1},8,["action","headers"])])),_:1},8,["subTitle","formOpts"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-4fe1c774"]]);export{E as default};
