import{ar as e,aP as a,d as t,f as l,r as s,a as n,C as r,o as i,F as o,i as u,j as d,n as g,w as m,q as p,m as c,l as b,k as y,B as v,U as T}from"./index-455b6c01.js";import{m as M,b as S,n as h,g as L}from"./constant-bd962a5b.js";import{m as f}from"./mittBus-7db26ecd.js";const E={key:0},_=["innerHTML"],I={key:1},V={key:2},H=["src"],P={key:3},q=["src"],x={key:4},C={key:5},Y=["innerHTML"],k=t({...t({name:"myMessage"}),setup(t){l(),s();const k=e=>{w.table.pageSize=e,W()},A=e=>{w.table.currentPage=e,W()},G=n({dialogTableVisible:!1,dialogTableVisibleStatus:!1,currentMessage:null,statusCurrentMessage:null,statusForm:{messageStatus:""},statusFormRules:{messageStatus:[{required:!0,message:"请选择消息状态",trigger:"blur"}]}}),w=n({query:{type:"",content:"",messageStatus:"",messageType:""},table:{total:0,pageSize:10,currentPage:1,data:[],columns:[{prop:"senderName",label:"发送者",minWidth:100},{prop:"messageStatusLabel",label:"消息状态",minWidth:100},{prop:"messageTypeLabel",label:"消息类型",minWidth:100},{prop:"typeLabel",label:"消息分组",minWidth:100},{prop:"crateTimeLabel",label:"创建时间",minWidth:140},{prop:"updateTimeLabel",label:"更新时间",minWidth:140}],operator:[{text:"详情",fun:t=>{var l,s;"SEND_SUCCESS"===(null==(l=t.status)?void 0:l.status)&&(s={code:t.code},e({url:`${a}/gpt-application-server/v1.0/message/read`,method:"post",params:{},data:s,noLoading:!0})).then((()=>{f.emit("messageUpdate"),W("search")})),G.currentMessage=t,G.dialogTableVisible=!0}}],operatorConfig:{fixed:"right",align:"center",width:"120",label:"操作"}},listTypeInfo:{messageTypeList:M,messageStatusList:S,noticeTypeList:h}}),z=r((()=>({messageType:{label:"消息类型",comp:"el-select",arrLabel:"label",arrKey:"value",changeEvent:"change",type:"select-arr",list:"messageTypeList",listTypeInfo:w.listTypeInfo},messageStatus:{label:"消息状态",arrLabel:"label",arrKey:"value",comp:"el-select",changeEvent:"change",type:"select-arr",list:"messageStatusList",listTypeInfo:w.listTypeInfo},type:{label:"消息分组",arrLabel:"label",arrKey:"value",comp:"el-select",changeEvent:"change",type:"select-arr",list:"noticeTypeList",listTypeInfo:w.listTypeInfo},content:{label:"消息内容",comp:"el-input"}}))),D=e=>{w.query={...w.query,...e},W("search")};i((()=>{W()}));const W=async t=>{"search"==t&&(w.table.currentPage=1);const l=await(s={...w.query,page:w.table.currentPage,pageSize:w.table.pageSize,name:w.query.name},e({url:`${a}/gpt-application-server/v1.0/message/MyMessage`,method:"get",params:s}));var s;w.table.total=l.data&&l.data.count||0,w.table.data=l.data&&l.data.data?l.data.data:[],w.table.data.forEach((e=>{var a,t,l,s,n;e.crateTimeLabel=o(Number(e.crateTime)).format("YYYY-MM-DD HH:mm"),e.updateTimeLabel=o(Number(e.updateTime)).format("YYYY-MM-DD HH:mm"),e.messageStatusLabel=(null==(a=null==e?void 0:e.status)?void 0:a.status)?null==(l=L(null==(t=null==e?void 0:e.status)?void 0:t.status,S))?void 0:l.label:"--",e.messageTypeLabel=(null==e?void 0:e.messageType)?null==(s=L(null==e?void 0:e.messageType,M))?void 0:s.label:"--",e.typeLabel=(null==e?void 0:e.messageType)?null==(n=L(null==e?void 0:e.type,h))?void 0:n.label:"--"}));const n=Math.ceil(w.table.total/w.table.pageSize);return n<w.table.currentPage&&0!==w.table.total?(w.table.currentPage=n,W()):0===w.table.total&&(w.table.currentPage=1),!1};return(e,a)=>{const t=u("t-query-condition"),l=u("t-layout-page-item"),s=u("t-table"),n=u("el-image"),r=u("el-dialog"),i=u("t-layout-page");return d(),g(i,{class:"menu_mange"},{default:m((()=>[p(l,null,{default:m((()=>[p(t,{opts:z.value,onSubmit:D},null,8,["opts"])])),_:1}),p(l,null,{default:m((()=>[p(s,{title:"消息通知",table:c(w).table,columns:c(w).table.columns,onSizeChange:k,onPageChange:A},null,8,["table","columns"])])),_:1}),p(r,{title:"消息体",class:"custom-class-message-info-dialog",top:"100px",modelValue:c(G).dialogTableVisible,"onUpdate:modelValue":a[0]||(a[0]=e=>c(G).dialogTableVisible=e),width:"480","append-to-body":!0,"destroy-on-close":!0},{default:m((()=>{var e,a,t,l,s,r,i,o,u,g,m,M;return[b("div",null,["TEXT_MESSAGE"===(null==(e=c(G).currentMessage)?void 0:e.messageType)?(d(),y("div",E,[b("div",{innerHTML:null==(a=c(G).currentMessage)?void 0:a.content},null,8,_)])):v("",!0),"IMAGE_MESSAGE"===(null==(t=c(G).currentMessage)?void 0:t.messageType)?(d(),y("div",I,[p(n,{style:{width:"360px"},src:null==(l=c(G).currentMessage)?void 0:l.content,fit:"contain"},null,8,["src"])])):v("",!0),"VIDEO_MESSAGE"===(null==(s=c(G).currentMessage)?void 0:s.messageType)?(d(),y("div",V,[b("video",{src:null==(r=c(G).currentMessage)?void 0:r.content,style:{width:"360px",height:"240px"}},null,8,H)])):v("",!0),"VOICE_MESSAGE"===(null==(i=c(G).currentMessage)?void 0:i.messageType)?(d(),y("div",P,[b("audio",{src:null==(o=c(G).currentMessage)?void 0:o.content},null,8,q)])):v("",!0),"LINK_MESSAGE"===(null==(u=c(G).currentMessage)?void 0:u.messageType)?(d(),y("div",x,T(null==(g=c(G).currentMessage)?void 0:g.content),1)):v("",!0),"HTML_MESSAGE"===(null==(m=c(G).currentMessage)?void 0:m.messageType)?(d(),y("div",C,[b("div",{innerHTML:null==(M=c(G).currentMessage)?void 0:M.content},null,8,Y)])):v("",!0)])]})),_:1},8,["modelValue"])])),_:1})}}});export{k as default};
